---
title: "Follicular Cholecystitis"
description: |
  Data Analysis for Follicular Cholecystitis.
author:
  - name: Serdar Balcı 
    url: https://www.serdarbalci.com/
    affiliation: MD Pathologist
    affiliation_url: https://sbalci.github.io/
date: "`r Sys.Date()`"
output: 
  pdf_document: 
    fig_caption: yes
    highlight: kate
    number_sections: yes
    toc: yes
    latex_engine: lualatex
  distill::distill_article:
    toc: true
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = NA)
```


# Initial Table


![initial table](img/initialTable.png)




---


```{r load library}
source("R/loadLibrary.R")
```


```{r import data, include=FALSE}
FC1 <- read_excel("data/bahar mapping FC_kullanılacak excel.xlsx",
                  col_types = "text")
FC2 <- read_excel("data/FC data.xlsx",
                  col_types = "text")
FC3 <- read_excel("data/for serdar- 34 fc - Kopya.xls",
                  col_types = "text")
OC <- read_excel("data/for serdar-1108 ordinary yerine .xls",
                 col_types = "text")
```


```{r make names}
FC1 <- janitor::clean_names(FC1)
FC2 <- janitor::clean_names(FC2)
FC3 <- janitor::clean_names(FC3)
OC <- janitor::clean_names(OC)
```



```{r select columns}
FC1 <- FC1 %>% 
  select(SURGPATHNO = acc_number,
         Gender = sex,
         Age = age,
         Diagnosis = description,
         WallThickness = gb_wall_thickness_mm,
         Cholelithiasis = cholelithiasis)

FC2 <- FC2 %>% 
  select(SURGPATHNO = acc_number,
         Gender = sex,
         Age = age,
         WallThickness = wall_thickness,
         Cholelithiasis = cholelithiasis)

FC2$Diagnosis <- "FC"


FC3 <- FC3 %>% 
  select(SURGPATHNO = x1,
         Gender = cinsiyet,
         Age = yas,
         Diagnosis = hangi_gruba_girdi,
         WallThickness = kalinlik_mm,
         Cholelithiasis = tasi_var_mi_acik_olanlarin_tas_bilgisine_klinik_notlardan_ve_preop_radyolojik_tekikten_abdominal_ct_usg_den_ulasildi)

OC <- OC %>% 
  select(SURGPATHNO = x1,
         Gender = cinsiyet,
         Age = yas,
         WallThickness = kalinlik_mm,
         Cholelithiasis = tasi_var_mi_acik_olanlarin_tas_bilgisine_klinik_notlardan_ve_preop_radyolojik_tekikten_abdominal_ct_usg_den_ulasildi)

OC$Diagnosis <- "OC"
```


```{r numeric wallthickness, warning=FALSE}
# Wall Thickness
FC1$WallThickness <- as.numeric(as.character(FC1$WallThickness))
FC1$WallThickness <- FC1$WallThickness*10

FC2$WallThickness <- as.numeric(as.character(FC2$WallThickness))
FC2$WallThickness <- FC2$WallThickness*10

FC3$WallThickness <- as.numeric(as.character(FC3$WallThickness))

OC$WallThickness <- as.numeric(as.character(OC$WallThickness))

```






```{r combine data}
gallbladderFC <- bind_rows(
  FC1, FC2, FC3, OC
)
```


```{r first combine}
writexl::write_xlsx(gallbladderFC, "gallbladderFC_firstcombine.xlsx")
```



```{r clean surgpathno}
gallbladderFC$SURGPATHNO <- trimws(gallbladderFC$SURGPATHNO)
gallbladderFC$SURGPATHNO <- gsub(pattern = "[a-zA-Z]", replacement = "", x = gallbladderFC$SURGPATHNO)
gallbladderFC$SURGPATHNO <- gsub(pattern = "-", replacement = " ", x = gallbladderFC$SURGPATHNO)
gallbladderFC$SURGPATHNO <- substr(x = gallbladderFC$SURGPATHNO, start = 1, stop = 9)
gallbladderFC$SURGPATHNO <- trimws(gallbladderFC$SURGPATHNO)
```




```{r find remove duplicated data}
# length(gallbladderFC$SURGPATHNO)
# length(unique(gallbladderFC$SURGPATHNO))

duplicatedRows <- which(
  duplicated(gallbladderFC$SURGPATHNO)
)

# gallbladderFC$SURGPATHNO[which(!duplicated(gallbladderFC$SURGPATHNO))]

gallbladderFC <- gallbladderFC[-duplicatedRows,]
```




```{r recode data}
## Recoding gallbladderFC$Gender into gallbladderFC$Gender_rec
gallbladderFC$Gender_rec <- recode(gallbladderFC$Gender,
               "FEMALE" = "Female",
               "MALE" = "Male",
               "f" = "Female",
               "m" = "Male")
gallbladderFC$Gender_rec <- factor(gallbladderFC$Gender_rec)

# Age

gallbladderFC$Age <- as.numeric(as.character(gallbladderFC$Age))


## Recoding gallbladderFC$Diagnosis into gallbladderFC$Diagnosis_rec
gallbladderFC$Diagnosis_rec <- recode(gallbladderFC$Diagnosis,
               "FOLL" = "FC")
gallbladderFC$Diagnosis_rec <- factor(gallbladderFC$Diagnosis_rec)


## Recoding gallbladderFC$Cholelithiasis into gallbladderFC$Cholelithiasis_rec
gallbladderFC$Cholelithiasis_rec <- recode(gallbladderFC$Cholelithiasis,
               "YES" = "Present",
               "NO" = "Absent",
               "1" = "Present",
               "0" = "Absent")
gallbladderFC$Cholelithiasis_rec <- factor(gallbladderFC$Cholelithiasis_rec)
```




```{r select data}
gallbladderFC <- gallbladderFC %>% 
  select(SURGPATHNO = SURGPATHNO,
         Age = Age,
         Gender = Gender_rec,
         Diagnosis = Diagnosis_rec,
         Cholelithiasis = Cholelithiasis_rec,
         WallThickness = WallThickness)
```



---

\pagebreak


# Cross Table

```{r cross table preparation}
dependent <- "Diagnosis"
explanatory <- c("Age", "Gender", "Cholelithiasis", "WallThickness")
```



```{r crosstable}
gallbladderFC %>%
  summary_factorlist(dependent, explanatory,
  p = TRUE, add_dependent_label = TRUE) -> gallbladderTable1

knitr::kable(gallbladderTable1, row.names = FALSE, align = c("l", "l", "r", "r", "r"))
```


# Age


```{r ggstatplot Age, layout="l-page"}
gallbladderFC %>% 
  ggstatsplot::ggbetweenstats(data = ., x = Diagnosis, y = Age, plot.type = "boxviolin")
```


# Gender

```{r ggstatplot gender, layout="l-page"}
gallbladderFC %>% 
    ggstatsplot::ggbarstats(data = ., main = Gender, condition = Diagnosis)
```



# Cholelithiasis


```{r ggstatplot cholelithiasis, layout="l-page"}
gallbladderFC %>% 
    ggstatsplot::ggbarstats(data = ., main = Cholelithiasis, condition = Diagnosis)
```


# Wall Thickness


```{r ggstatplot WallThickness, layout="l-page"}
gallbladderFC %>% 
  ggstatsplot::ggbetweenstats(data = ., x = Diagnosis, y = WallThickness, plot.type = "boxviolin")
```


```{r}
jmv::ttestIS(
    formula = WWallThickness ~ Diagnosis,
    data = gallbladderFC,
    vars = vars(WallThickness),
    welchs = TRUE,
    mann = TRUE,
    norm = TRUE,
    eqv = TRUE,
    ci = TRUE,
    desc = TRUE,
    plots = TRUE)
```




```{r child='_footer.Rmd'}
```
