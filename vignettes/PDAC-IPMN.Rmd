---
title: "Analysis for PDAC IPMN USCAP 2019 presentation"
description: |
  Analysis for PDAC IPMN USCAP 2019 presentation
output: html_notebook
author:
  - name: analysis by Serdar Balci 
    url: https://www.serdarbalci.com
    affiliation: serdarbalci.com
    affiliation_url: https://www.serdarbalci.com
date: "`r Sys.Date()`"
# output: radix::radix_article
---

<style>
    body .main-container {
        max-width: 90%;
    }
</style>


```{r setup global chunk settings, include=FALSE}
knitr::opts_chunk$set(comment = NA, include = TRUE, echo = FALSE)
```


```{r library}
library(tidyverse)
library(foreign)
library(tidylog)
library(janitor)
```



# IPMN

```{r IPMN}
library(readxl) 
IPMN <- read_excel("PDAC-IPMN_raw.xlsx", 
    sheet = "Group 1-IPMN-a PDAC", col_types = c("text", 
        "text", "numeric", "numeric", "numeric", 
        "date", "text", "date", "numeric", 
        "numeric"))
# View(IPMN)
```


```{r}
IPMN <- janitor::clean_names(IPMN)
# cat(names(IPMN))
```


```{r IPMN recode select}
IPMN <- IPMN %>% 
  select(
    SURGPATHNO = x1,
    Group = group_1,
    CystSize = cyst_size,
    InvasionSize = inv_size,
    Tstage = t_ajcc_8,
    SurgeryDate = date_of_surgery,
    Outcome = outcome,
    FollowUpDate = date_of_last_f_u,
    OutcomeNum = outcome_alive_1_death_0,
    Survival = overall_survival_period_from_surgery_months
    )


## Recoding IPMN$Tstage into IPMN$Tstage_rec
IPMN$Tstage_rec <- as.character(IPMN$Tstage)
IPMN$Tstage_rec <- fct_recode(IPMN$Tstage_rec,
               "T1" = "1",
               "T2" = "2",
               "T3" = "3")


## Recoding IPMN$Outcome into IPMN$Outcome_rec
IPMN$Outcome_rec <- fct_recode(IPMN$Outcome,
               "1" = "death",
               "0" = "alive")
IPMN$Outcome_rec <- as.numeric(as.character(IPMN$Outcome_rec))




# table(IPMN$Outcome_rec, IPMN$Outcome)

IPMN <- IPMN %>%
  select(
    SURGPATHNO,
    Group,
    CystSize,
    InvasionSize,
    Tstage = Tstage_rec,
    Outcome = Outcome_rec,
    Survival
    )

IPMN$InvasionSize <- as.numeric(IPMN$InvasionSize)

```


# PseudoIPMN

```{r PseudoIPMN}
library(readxl)
PseudoIPMN <- read_excel("PDAC-IPMN_raw.xlsx", 
    sheet = "Group 2-PseudoIPMN", col_types = c("text", 
        "text", "text", "text", "numeric", 
        "numeric", "numeric", "text", "text", 
        "text", "text", "text"))
# View(PseudoIPMN)
```


```{r select PseudoIPMN}
PseudoIPMN <- PseudoIPMN %>% 
  select(
    SURGPATHNO = `Patho No`,
    Group = `Group 2-PDAC with pseudo IPMN`,
    Outcome = STATUS,
    OutcomeNum = `outcome (1;alive, 0;dead)`,
    Survival = `Survival (months)`,
    InvasionSize = `Size of invasive ca (mm)`,
    Tstage = `T-AJCC 8`
  )
```



```{r recode PseudoIPMN}
# table(PseudoIPMN$Outcome, PseudoIPMN$OutcomeNum)

## Recoding PseudoIPMN$Group into PseudoIPMN$Group_rec
PseudoIPMN$Group_rec <- fct_recode(PseudoIPMN$Group,
               "PseudoIPMN" = "Group  2")


## Recoding PseudoIPMN$Outcome into PseudoIPMN$Outcome_rec
PseudoIPMN$Outcome_rec <- fct_recode(PseudoIPMN$Outcome,
               "0" = "alive",
               "1" = "death")
PseudoIPMN$Outcome_rec <- as.numeric(as.character(PseudoIPMN$Outcome_rec))




## Recoding PseudoIPMN$Tstage into PseudoIPMN$Tstage_rec
PseudoIPMN$Tstage_rec <- fct_recode(PseudoIPMN$Tstage,
               "T2" = "2",
               "T1" = "1",
               "T3" = "3",
               NULL = "CIS"
               )

PseudoIPMN$InvasionSize <- as.numeric(PseudoIPMN$InvasionSize)

```


```{r select PseudoIPMN 2}
PseudoIPMN <- PseudoIPMN %>% 
  select(
    SURGPATHNO,
    Group = Group_rec,
    Outcome = Outcome_rec,
    Survival,
    InvasionSize,
    Tstage = Tstage_rec
  )
```




<!-- # MCN -->

<!-- ```{r MCN} -->
<!-- library(readxl) -->
<!-- MCN_PDAC <- read_excel("PDAC-IPMN_raw.xlsx",  -->
<!--     sheet = "Group 3- MCN-a PDAC", col_types = c("text",  -->
<!--         "text", "numeric", "numeric", "numeric",  -->
<!--         "date", "text", "date", "numeric",  -->
<!--         "numeric")) -->
<!-- # View(MCN_PDAC) -->
<!-- ``` -->

<!-- ```{r MCN select 1} -->
<!-- MCN <- MCN_PDAC %>%  -->
<!--   select( -->
<!--     SURGPATHNO = X__1, -->
<!--     Group = `group 3-MCNa PDAC`, -->
<!--     CystSize = `cyst size`, -->
<!--     InvasionSize = `inv. Size`, -->
<!--     Tstage = `T-AJCC 8`, -->
<!--     Outcome = outcome, -->
<!--     OutcomeNum = `outcome (alive;1, death;0)`, -->
<!--     Survival = `overall survival period from surgery (months)` -->
<!--     ) -->
<!-- ``` -->

<!-- ```{r MCN recode} -->
<!-- # table(MCN$Outcome, MCN$OutcomeNum) -->

<!-- ## Recoding MCN$Outcome into MCN$Outcome_rec -->
<!-- MCN$Outcome_rec <- fct_recode(MCN$Outcome, -->
<!--                "Alive" = "alive", -->
<!--                "Dead" = "death") -->

<!-- ## Recoding MCN$Tstage into MCN$Tstage_rec -->
<!-- MCN$Tstage_rec <- as.character(MCN$Tstage) -->
<!-- MCN$Tstage_rec <- fct_recode(MCN$Tstage_rec, -->
<!--                "T1" = "1", -->
<!--                "T3" = "3", -->
<!--                "T2" = "2") -->

<!-- MCN$InvasionSize <- as.numeric(MCN$InvasionSize) -->



<!-- ``` -->

<!-- ```{r} -->
<!-- MCN <- MCN %>%  -->
<!--   select( -->
<!--     SURGPATHNO, -->
<!--     Group, -->
<!--     CystSize, -->
<!--     InvasionSize, -->
<!--     Tstage = Tstage_rec, -->
<!--     Outcome = Outcome_rec, -->
<!--     Survival -->
<!--   ) -->


<!-- ``` -->



# Ordinary PDAC

```{r Ordinary PDAC}
library(readxl)
Ordinary_PDAC <- read_excel("PDAC-IPMN_raw.xlsx", 
    sheet = "Group 4-Ordinary PDACs", col_types = c("text", 
        "date", "date", "numeric", "text", 
        "text", "numeric", "text", "numeric", 
        "text", "numeric", "text", "text", 
        "text", "text", "numeric", "text", 
        "text", "text", "text", "text"))

# View(Ordinary_PDAC)
```


```{r select ordinary PDAC}
Ordinary_PDAC <- Ordinary_PDAC %>% 
  select(
    SURGPATHNO = `SURG PATH NO`,
    Survival = MONTHS,
    Outcome = outcome,
    OutcomeNum = `outcome (1:alive)`,
    InvasionSize = `size mm..13`,
    Tstage = `T AJCC 8`,
    AGE,
    GENDER,
    LN,
    MARGIN
  )

```


```{r recode ordinary PDAC}

Ordinary_PDAC$Group <- "OrdinaryPDAC"

## Recoding Ordinary_PDAC$Outcome into Ordinary_PDAC$Outcome_rec
Ordinary_PDAC$Outcome_rec <- fct_recode(Ordinary_PDAC$Outcome,
               "1" = "dead",
               "0" = "alive")
Ordinary_PDAC$Outcome_rec <- as.numeric(as.character(Ordinary_PDAC$Outcome_rec))



## Recoding Ordinary_PDAC$Tstage into Ordinary_PDAC$Tstage_rec
Ordinary_PDAC$Tstage_rec <- as.character(Ordinary_PDAC$Tstage)
Ordinary_PDAC$Tstage_rec <- fct_recode(Ordinary_PDAC$Tstage_rec,
               "T1" = "1",
               "T2" = "2",
               "T3" = "3")

## Recoding Ordinary_PDAC$GENDER into Ordinary_PDAC$GENDER_rec
Ordinary_PDAC$GENDER_rec <- fct_recode(Ordinary_PDAC$GENDER,
               "Female" = "F",
               "Male" = "M")


## Recoding Ordinary_PDAC$LN into Ordinary_PDAC$LN_rec
Ordinary_PDAC$LN_rec <- fct_recode(Ordinary_PDAC$LN,
               "Positive" = "1",
               "Negative" = "0",
               "Positive" = "1a",
               NULL = "not be assessed",
               "Positive" = "3")


## Recoding Ordinary_PDAC$MARGIN into Ordinary_PDAC$MARGIN_rec
Ordinary_PDAC$MARGIN_rec <- fct_recode(Ordinary_PDAC$MARGIN,
               "Negative" = "0",
               "Positive" = "1",
               NULL = "X",
               "Positive" = "pancreatic neck margin positive",
               "Positive" = "neck",
               "Positive" = "BD and neck",
               "Positive" = "2",
               "Positive" = "uncinate margin positive")


```


```{r ordinary PDAC select 2}
Ordinary_PDAC <- Ordinary_PDAC %>% 
  select(
    SURGPATHNO,
    Group,
    Survival,
    Outcome = Outcome_rec,
    InvasionSize,
    Tstage = Tstage_rec,
    Age = AGE,
    Gender = GENDER_rec,
    LN = LN_rec,
    Margin = MARGIN_rec
  )

Ordinary_PDAC$InvasionSize <- as.numeric(Ordinary_PDAC$InvasionSize)


```


# Combined Data

```{r}
saveRDS(IPMN, "IPMN.rds")
saveRDS(PseudoIPMN, "PseudoIPMN.rds")
saveRDS(Ordinary_PDAC, "Ordinary_PDAC.rds")
```


```{r}
library(summarytools)
# view(dfSummary(PseudoIPMN))
# view(dfSummary(MCN))
# view(dfSummary(IPMN))
# view(dfSummary(Ordinary_PDAC))

```

```{r}
PDACIPMNdata <- bind_rows(IPMN, PseudoIPMN, Ordinary_PDAC)

# view(dfSummary(PDACIPMNdata))

```

# Add missings from other excels

```{r}
library(readxl)
all_pancreas <- read_excel("PDAC-IPMN_raw.xlsx", 
    sheet = "general pancreas ca list")

all_pancreas <- all_pancreas %>% 
    select(
        SURGPATHNO = `SURG PATH NO`,
        AGE,
        GENDER,
        LN,
        MARGIN
    )

```

```{r}
PDACIPMNdata <- PDACIPMNdata %>% 
    left_join(all_pancreas, by = "SURGPATHNO")
```



```{r}
PDACIPMNdata$Age[is.na(PDACIPMNdata$Age)] <- PDACIPMNdata$AGE[is.na(PDACIPMNdata$Age)]


PDACIPMNdata$Age <- as.numeric(PDACIPMNdata$Age)

PDACIPMNdata$Gender <- as.character(PDACIPMNdata$Gender)

PDACIPMNdata$Gender[is.na(PDACIPMNdata$Gender)] <- PDACIPMNdata$GENDER[is.na(PDACIPMNdata$Gender)]

## Recoding PDACIPMNdata$Gender into PDACIPMNdata$Gender_rec
PDACIPMNdata$Gender_rec <- fct_recode(PDACIPMNdata$Gender,
               "Female" = "F",
               "Male" = "M")

PDACIPMNdata$Margin <- as.character(PDACIPMNdata$Margin)

PDACIPMNdata$Margin[is.na(PDACIPMNdata$Margin)] <- PDACIPMNdata$MARGIN[is.na(PDACIPMNdata$Margin)]


## Recoding PDACIPMNdata$Margin into PDACIPMNdata$Margin_rec
PDACIPMNdata$Margin_rec <- fct_recode(PDACIPMNdata$Margin,
               "Positive" = "1",
               "Negative" = "0",
               NULL = "X")


PDACIPMNdata$LN.x <- as.character(PDACIPMNdata$LN.x)

PDACIPMNdata$LN.x[is.na(PDACIPMNdata$LN.x)] <- PDACIPMNdata$LN.y[is.na(PDACIPMNdata$LN.x)]

## Recoding PDACIPMNdata$LN.x into PDACIPMNdata$LN_rec
PDACIPMNdata$LN_rec <- fct_recode(PDACIPMNdata$LN.x,
               "Positive" = "1",
               "Negative" = "0",
               NULL = "not be assessed")

PDACIPMNdata <- PDACIPMNdata %>% 
    select(
        SURGPATHNO,
        Group,
        CystSize,
        InvasionSize,
        Tstage,
        Outcome,
        Survival,
        Age,
        Gender = Gender_rec,
        LN = LN_rec,
        Margin = Margin_rec
    )

```


```{r}
PDAC_IPMN_demographics <- read_excel("PDAC_IPMN_demographics.xlsx")

PDACIPMNdata <- PDACIPMNdata %>% 
    left_join(PDAC_IPMN_demographics, by = "SURGPATHNO")

PDACIPMNdata$Age.x[is.na(PDACIPMNdata$Age.x)] <- PDACIPMNdata$Age.y[is.na(PDACIPMNdata$Age.x)]


PDACIPMNdata$Age <- as.numeric(PDACIPMNdata$Age.x)

PDACIPMNdata$Gender.x <- as.character(PDACIPMNdata$Gender.x)

PDACIPMNdata$Gender.x[is.na(PDACIPMNdata$Gender.x)] <- PDACIPMNdata$Gender.y[is.na(PDACIPMNdata$Gender.x)]

PDACIPMNdata$Gender <- as.factor(PDACIPMNdata$Gender.x)

## Reordering PDACIPMNdata$Gender
PDACIPMNdata$Gender <- factor(PDACIPMNdata$Gender, levels=c("Male", "Female"))



```


```{r}
PDACIPMNdata <- PDACIPMNdata %>%
    select(
        SURGPATHNO,
        Group,
        Age,
        Gender,
        CystSize,
        InvasionSize,
        Tstage,
        Outcome,
        Survival,
        LN,
        Margin
    )
    
```


```{r}
Cyst_more_than_1cm_PDAC_Muraki <- read_excel("Cyst more than 1cm PDAC Muraki.xlsx") %>% 
    select(SURGPATHNO = `Patho No`,
           Cystsize2 = `Cyst size`)
# View(Cyst_more_than_1cm_PDAC_Muraki)

PDACIPMNdata <- PDACIPMNdata %>% 
    left_join(Cyst_more_than_1cm_PDAC_Muraki, by = "SURGPATHNO")

PDACIPMNdata$CystSize[is.na(PDACIPMNdata$CystSize)] <- PDACIPMNdata$Cystsize2[is.na(PDACIPMNdata$CystSize)]

PDACIPMNdata <- PDACIPMNdata %>% select(-Cystsize2)
```


# Save PDACIPMNdata


```{r}
saveRDS(PDACIPMNdata, "PDACIPMNdata.rds")
```

```{r}
library("summarytools")
view(dfSummary(PDACIPMNdata))
```


# Analysis

## Descriptives



<!-- ```{r include=FALSE} -->
<!-- PDACIPMNdata %>%  -->
<!--   tabyl(Group) %>%  -->
<!--   adorn_pct_formatting(digits = 0, affix_sign = TRUE) %>% -->
<!--   adorn_totals(where = "row") -> t1 -->

<!-- knitr::kable(t1) -->
<!-- ``` -->


<!-- ```{r} -->
<!-- PDACIPMNdata %>%  -->
<!--   tabyl(Group, Gender) %>%  -->
<!--   adorn_totals(where = c("row", "col")) -->
<!-- ``` -->





### jmv

```{r descriptives1, layout="l-body-outset"}
jmv::descriptives(
    data = PDACIPMNdata,
    vars = vars("Age", "CystSize", "InvasionSize"),
    splitBy = "Group",
    mean = TRUE, 
    median = TRUE,
    freq = TRUE,
    hist = TRUE,
    dens = TRUE,
    bar = TRUE,
    box = TRUE,
    violin = TRUE,
    dot = TRUE,
    mode = TRUE,
    sum = TRUE,
    sd = TRUE,
    variance = TRUE,
    range = TRUE,
    se = TRUE,
    skew = TRUE,
    kurt = TRUE,
    quart = TRUE,
    pcEqGr = TRUE)
```



```{r descriptives 2, layout="l-body-outset"}
jmv::descriptives(
    data = PDACIPMNdata,
    vars = vars("Gender", "Tstage",  "LN", "Margin"),
    splitBy = "Group",
    mean = FALSE,
    median = FALSE,
    min = FALSE,
    max = FALSE,
    freq = TRUE,
    hist = TRUE,
    dens = TRUE,
    bar = TRUE,
    box = TRUE,
    violin = TRUE,
    dot = TRUE
    )
```


```{r descriptives3, layout="l-body-outset"}
jmv::descriptives(
    data = PDACIPMNdata,
    vars = vars("InvasionSize"),
    splitBy = "Tstage",
    mean = TRUE, 
    median = TRUE,
    freq = TRUE,
    hist = TRUE,
    dens = TRUE,
    bar = TRUE,
    box = TRUE,
    violin = TRUE,
    dot = TRUE,
    mode = TRUE,
    sum = FALSE,
    sd = TRUE,
    variance = TRUE,
    range = TRUE,
    se = TRUE,
    skew = TRUE,
    kurt = TRUE,
    quart = TRUE,
    pcEqGr = TRUE, 
    qq = TRUE)
```



## Cross Table

### Tangram 

Tangram output in seperate file

```{r tangram}
# cat(names(PDACIPMNdata))

library(tangram)
write(html5(tangram("Group::Categorical ~ Age + Gender::Categorical + CystSize + InvasionSize + Tstage::Categorical + LN::Categorical + Margin::Categorical + Outcome::Categorical", PDACIPMNdata), fragment=TRUE, inline="nejm.css", caption = "IPMN PDAC Table", id="tbl3"),
"IPMN_PDAC_Table.html")

```

### finalfit

```{r}
library(finalfit)
library(dplyr)
```

```{r}
dependent <- "Group"
explanatory1 <- c("Age", "Gender", "InvasionSize", "Tstage")

# explanatory2 <- c("CystSize")
# explanatory5 <- "LN"
# explanatory6 <- "Margin"
```


```{r crosstable}
PDACIPMNdata %>%
  summary_factorlist(dependent, explanatory1,
  p=TRUE, add_dependent_label=TRUE) -> t2

knitr::kable(t2, row.names=FALSE, align = c("l", "l", "r", "r", "r")
)
```




```{r}
p <- ggplot(PDACIPMNdata, aes(Group, InvasionSize))
p + geom_jitter() 
p + geom_jitter(aes(colour = Tstage)) 
```



```{r}
p2 <- ggplot(PDACIPMNdata, aes(Tstage, InvasionSize))
p2 + geom_jitter() 
p2 + geom_jitter(aes(colour = Group)) 
```




<!-- # jsmodule -->

<!-- ```{r} -->
<!-- jsmodule::jsBasicGadget(PDACIPMNdata) -->
<!-- ``` -->



## Survival




```{r}
PDACIPMNdata$time <- round(PDACIPMNdata$Survival, digits = 1)

## Recoding data$Group
PDACIPMNdata$Group <- fct_recode(PDACIPMNdata$Group,
               "IPMN" = "IPMN-a",
               "PDAC" = "OrdinaryPDAC")



```




```{r}
library(survival)
library(ranger)
library(ggplot2)
library(dplyr)
library(ggfortify)
```


```{r}
PDACIPMNdata %>% select(-SURGPATHNO) %>% 
write_csv("PDACIPMN.csv")

writexl::write_xlsx(PDACIPMNdata, "PDACIPMNdata.xlsx")

```


```{r jmv survival 1}

deathwatch::surv(
    data = PDACIPMNdata,
    event = "Outcome",
    eventLevel = "1",
    elapsed = "time",
    groups = "Group",
    tests = "logrank")

```


```{r jmv survival 2}

deathwatch::surv(
    data = PDACIPMNdata,
    event = "Outcome",
    eventLevel = "1",
    elapsed = "time",
    groups = "Tstage",
    tests = "logrank")

```

```{r}

km_fitTstage <- survfit(Surv(time, Outcome) ~ Tstage, data = PDACIPMNdata)

km_fitTstage

summary(km_fitTstage, times = c(12,36,60))


```




```{r T stage vs Group}
PDACIPMNdata %>% 
    filter(!is.na(time)) %>% 
    filter(!is.na(Tstage)) %>% 
    count(Tstage, Group) %>% 
    spread(Group, n)
    
```

In T1 there are 33 IPMN, 78 PDAC and 4 PseudoIPMN with complete survival information. Among T1 cases median survivals are IPMN: 44.2, PDAC 35.3, PseudoIPMN:13.9. Here the difference is between PseudoIPMN and IPMN but not among others (p=0.030).

In T2 there are 12 IPMN, 233 PDAC and 11 PseudoIPMN with complete survival information. Among T2 cases median survivals are IPMN: 89.9, PDAC 23.3, PseudoIPMN:NA. Here there are no differences in terms of survival.

In T3 there are 5 IPMN, 56 PDAC and 10 PseudoIPMN with complete survival information. Among T3 cases median survivals are IPMN: 24.8, PDAC 15.5, PseudoIPMN:12.7. Here there are no differences in terms of survival.







```{r jmv survival per T1}
PDACIPMNdata %>% 
    filter(Tstage == "T1") %>% 
    deathwatch::surv(
    data = ,
    event = "Outcome",
    eventLevel = "1",
    elapsed = "time",
    groups = "Group",
    tests = "logrank")
```


```{r jmv survival per T2}
PDACIPMNdata %>% 
    filter(Tstage == "T2") %>% 
    deathwatch::surv(
    data = ,
    event = "Outcome",
    eventLevel = "1",
    elapsed = "time",
    groups = "Group",
    tests = "logrank")
```

```{r jmv survival per T3}
PDACIPMNdata %>% 
    filter(Tstage == "T3") %>% 
    deathwatch::surv(
    data = ,
    event = "Outcome",
    eventLevel = "1",
    elapsed = "time",
    groups = "Group",
    tests = "logrank")
```




```{r}
PDACIPMNdata2 <- PDACIPMNdata %>% 
  filter(!is.na(Survival))
```




```{r}
library(survival)
km <- with(PDACIPMNdata2, Surv(time, Outcome))

head(km,80)

plot(km)

```





```{r}
km_fit <- survfit(Surv(time, Outcome) ~ Group, data = PDACIPMNdata)

km_fit

```

```{r 1-3-5-yr survival}
summary(km_fit, times = c(12,36,60))

```

```{r}

IPMNdata <- PDACIPMNdata %>% filter(Group == "IPMN")

km_fitIPMNdata <- survfit(Surv(time, Outcome) ~ Group, data = IPMNdata)

km_fitIPMNdata

summary(km_fitIPMNdata, times = c(12,36,60))


```



```{r}

IPMNdataT1 <- PDACIPMNdata %>% filter(Group == "IPMN") %>% filter(Tstage == "T1")

km_fitIPMNdataT1 <- survfit(Surv(time, Outcome) ~ 1, data = IPMNdataT1)

km_fitIPMNdataT1

summary(km_fitIPMNdataT1, times = c(12,36,60))


```


```{r}

IPMNdataT2 <- PDACIPMNdata %>% filter(Group == "IPMN") %>% filter(Tstage == "T2")

km_fitIPMNdataT2 <- survfit(Surv(time, Outcome) ~ 1, data = IPMNdataT2)

km_fitIPMNdataT2

summary(km_fitIPMNdataT2, times = c(12,36,60))


```

```{r}

IPMNdataT3 <- PDACIPMNdata %>% filter(Group == "IPMN") %>% filter(Tstage == "T3")

km_fitIPMNdataT3 <- survfit(Surv(time, Outcome) ~ 1, data = IPMNdataT3)

km_fitIPMNdataT3

summary(km_fitIPMNdataT3, times = c(12,36,60))


```


```{r}

PDACdataT1 <- PDACIPMNdata %>% filter(Group == "PDAC") %>% filter(Tstage == "T1")

km_fitPDACdataT1 <- survfit(Surv(time, Outcome) ~ 1, data = PDACdataT1)

km_fitPDACdataT1

summary(km_fitPDACdataT1, times = c(12,36,60))


```


```{r}

PDACdataT2 <- PDACIPMNdata %>% filter(Group == "PDAC") %>% filter(Tstage == "T2")

km_fitPDACdataT2 <- survfit(Surv(time, Outcome) ~ 1, data = PDACdataT2)

km_fitPDACdataT2

summary(km_fitPDACdataT2, times = c(12,36,60))


```

```{r}

PDACdataT3 <- PDACIPMNdata %>% filter(Group == "PDAC") %>% filter(Tstage == "T3")

km_fitPDACdataT3 <- survfit(Surv(time, Outcome) ~ 1, data = PDACdataT3)

km_fitPDACdataT3

summary(km_fitPDACdataT3, times = c(12,36,60))


```


```{r}

PseudoIPMNdataT1 <- PDACIPMNdata %>% filter(Group == "PseudoIPMN") %>% filter(Tstage == "T1")

km_fitPseudoIPMNdataT1 <- survfit(Surv(time, Outcome) ~ 1, data = PseudoIPMNdataT1)

km_fitPseudoIPMNdataT1

summary(km_fitPseudoIPMNdataT1, times = c(12,36,60))


```


```{r}

PseudoIPMNdataT2 <- PDACIPMNdata %>% filter(Group == "PseudoIPMN") %>% filter(Tstage == "T2")

km_fitPseudoIPMNdataT2 <- survfit(Surv(time, Outcome) ~ 1, data = PseudoIPMNdataT2)

km_fitPseudoIPMNdataT2

summary(km_fitPseudoIPMNdataT2, times = c(12,36,60))


```

```{r}

PseudoIPMNdataT3 <- PDACIPMNdata %>% filter(Group == "PseudoIPMN") %>% filter(Tstage == "T3")

km_fitPseudoIPMNdataT3 <- survfit(Surv(time, Outcome) ~ 1, data = PseudoIPMNdataT3)

km_fitPseudoIPMNdataT3

summary(km_fitPseudoIPMNdataT3, times = c(12,36,60))


```







```{r}
plot(km_fit,  xlab="Months", main = 'Kaplan Meyer Plot')

```

```{r}
library(survminer)
ggsurvplot(km_fit, data = PDACIPMNdata)
```






#### Cox proportional hazards: survival::coxph()
Of the form: survival::coxph(dependent ~ explanatory)



```{r}
library(finalfit)
library(survival)

explanatory2 <- c("Group", "Age", "Gender", "InvasionSize", "Tstage")

# explanatory2 <- c("CystSize")
# explanatory5 <- "LN"
# explanatory6 <- "Margin"

dependent2 = "Surv(time, Outcome)"

PDACIPMNdata %>%
  finalfit(dependent2, explanatory2) -> t6

knitr::kable(t6, row.names=FALSE, align=c("l", "l", "r", "r", "r", "r"))
```





#### Kaplan-Meier


```{r}
explanatoryKM1 <-  c("Group")
dependentKM1 <-  "Surv(time, Outcome)"
PDACIPMNdata %>%
  surv_plot(dependentKM1, explanatoryKM1, 
  xlab="Time (months)", pval=TRUE, legend = "none")
```







```{r}
library(finalfit)
library(survival)
explanatoryS2 <- c("Group")
dependentS2 = "Surv(time, Outcome)"
PDACIPMNdata %>%
  finalfit(dependentS2, explanatoryS2) -> t7

knitr::kable(t7, row.names=FALSE, align=c("l", "l", "r", "r", "r", "r"))
```

```{r}
survminer::pairwise_survdiff(formula = Surv(time, Outcome) ~ Group, data = PDACIPMNdata, p.adjust.method = "BH")
```



```{r}
explanatoryKM2 <-  c("Group")
dependentKM2 <-  "Surv(time, Outcome)"
PDACIPMNdata %>%
  surv_plot(dependentKM2, explanatoryKM2, 
  xlab="Time (months)", pval=TRUE, legend = "none")
```







