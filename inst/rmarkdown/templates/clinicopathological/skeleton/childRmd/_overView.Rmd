# Define Variable Types

```{r define continious variables, eval=FALSE, include=FALSE}
mydataDescription <- describer::describe(mydata)

mydataDescription %>% 
    janitor::clean_names() %>% 
    dplyr::filter(column_type == "numeric" | column_type == "double") %>% 
    dplyr::select(column_name) %>% 
    dplyr::pull() -> continiousVariables
```



```{r inspectdf column types, eval=FALSE, include=FALSE}
inspectdf::inspect_types(starwars)

inspectdf::inspect_types(starwars) %>% 
  dplyr::filter(type == "character") %>% 
  dplyr::select(col_name) %>% 
  pull() %>% 
  unlist() -> characterVariables

inspectdf::inspect_types(starwars) %>% 
  dplyr::filter(type == "list") %>% 
  dplyr::select(col_name) %>% 
  pull() %>% 
  unlist() -> listVariables

inspectdf::inspect_types(starwars) %>% 
  dplyr::filter(type == "numeric") %>% 
  dplyr::select(col_name) %>% 
  pull() %>% 
  unlist() -> numericVariables

inspectdf::inspect_types(starwars) %>% 
  dplyr::filter(type == "integer") %>% 
  dplyr::select(col_name) %>% 
  pull() %>% 
  unlist() -> integerVariables
```


```{r inspectdf column types 2, eval=FALSE, include=FALSE}

inspectdf::inspect_types(mydata) %>% inspectdf::show_plot()

# inspectdf::inspect_types(star_1, star_2)
```









# Overview / Exploratory Data Analysis (EDA)


```{r summarytools, eval=FALSE, include=FALSE}
summarytools::view(summarytools::dfSummary(mydata))
```


```{r glimpse, eval=FALSE, include=FALSE}
glimpse(mydata)
```



```{r describer 1, eval=FALSE, include=FALSE}
library(dplyr, warn.conflicts = FALSE)
library(describer)

mydata %>% 
  describer::describe() %>% 
  knitr::kable(format = "markdown")
```


```{r describer group_by, eval=FALSE, include=FALSE}
mydata %>% 
  group_by(Grade) %>% 
  do(describe(.)) %>% 
  knitr::kable(format = "markdown")
```



```{r describer 2, eval=FALSE, include=FALSE}
describer::describe(mydata)
# describe(mtcars)
# describe(iris)
# describe(state.name)
```




```{r visdat, eval=FALSE, include=FALSE}
# https://github.com/ropensci/visdat
# http://visdat.njtierney.com/articles/using_visdat.html
# https://cran.r-project.org/web/packages/visdat/index.html
# http://visdat.njtierney.com/

visdat::vis_dat(airquality)
visdat::vis_miss(airquality)
visdat::vis_compare(airquality, airquality)
visdat::vis_expect(data = airquality, expectation = ~.x == -1, show_perc = TRUE)

visdat::vis_expect(airquality, ~.x >= 25)

visdat::vis_cor(airquality)
visdat::vis_guess(airquality)

visdat::vis_miss(airquality, 
         cluster = TRUE)

visdat::vis_miss(airquality,
         sort_miss = TRUE)


test_miss_df <- data.frame(x1 = 1:10000,
                           x2 = rep("A", 10000),
                           x3 = c(rep(1L, 9999), NA))

visdat::vis_miss(test_miss_df)



chickwts_diff <- chickwts
chickwts_diff[sample(1:nrow(chickwts), 30),sample(1:ncol(chickwts), 2)] <- NA

visdat::vis_compare(chickwts_diff, chickwts)


# plotly::ggplotly(visdat::vis_dat(airquality))
# ggplotly(vis_miss(airquality))
# ggplotly(vis_guess(airquality))

```






```{r DataExplorer, eval=FALSE, include=FALSE}
# https://cran.r-project.org/web/packages/DataExplorer/vignettes/dataexplorer-intro.html

# library(nycflights13)
# library(DataExplorer)
# data_list <- list(airlines, airports, flights, planes, weather)

DataExplorer::plot_str(mydata)

DataExplorer::plot_str(mydata, type = "r")


# merge_airlines <- merge(flights, airlines, by = "carrier", all.x = TRUE)
# merge_planes <- merge(merge_airlines, planes, by = "tailnum", all.x = TRUE, suffixes = c("_flights", "_planes"))
# merge_airports_origin <- merge(merge_planes, airports, by.x = "origin", by.y = "faa", all.x = TRUE, suffixes = c("_carrier", "_origin"))
# final_data <- merge(merge_airports_origin, airports, by.x = "dest", by.y = "faa", all.x = TRUE, suffixes = c("_origin", "_dest"))

DataExplorer::introduce(mydata)

DataExplorer::plot_intro(mydata)

DataExplorer::plot_missing(mydata)

mydata2 <- DataExplorer::drop_columns(mydata, "TStage")

DataExplorer::plot_bar(mydata)

DataExplorer::plot_bar(mydata, with = "Death")

DataExplorer::plot_histogram(mydata)


# final_data <- update_columns(final_data, "flight", as.factor)


# qq_data <- final_data[, c("arr_delay", "air_time", "distance", "seats")]
# plot_qq(qq_data, sampled_rows = 1000L)

# plot_correlation(na.omit(final_data), maxcat = 5L)



```



```{r xray, eval=FALSE, include=FALSE}
xray::anomalies(airquality)

xray::distributions(airquality)

```




```{r dataMaid, eval=FALSE, include=FALSE}
dataMaid::makeDataReport(data = mydata, 
                         file = here::here("out/dataMaid_mydata.Rmd"),
                         replace = TRUE,
                         openResult = FALSE
                         )
```



<!-- ```{r dataMaid 2, eval=FALSE, include=FALSE} -->
<!-- # https://cran.r-project.org/web/packages/dataMaid/vignettes/extending_dataMaid.html -->
<!-- library("dataMaid") -->
<!-- dataMaid::makeDataReport(mydata, -->
<!--   #add extra precheck function          -->
<!--   preChecks = c("isKey", "isSingular", "isSupported", "isID"), -->

<!--   #Add the extra summaries - countZeros() for character, factor,  -->
<!--   #integer, labelled and numeric variables and meanSummary() for integer,  -->
<!--   #numeric and logical variables: -->
<!--   summaries = setSummaries( -->
<!--     character = defaultCharacterSummaries(add = "countZeros"), -->
<!--     factor = defaultFactorSummaries(add = "countZeros"), -->
<!--     labelled = defaultLabelledSummaries(add = "countZeros"), -->
<!--     numeric = defaultNumericSummaries(add = c("countZeros", "meanSummary")), -->
<!--     integer = defaultIntegerSummaries(add = c("countZeros", "meanSummary")), -->
<!--     logical = defaultLogicalSummaries(add =  c("meanSummary")) -->
<!--   ), -->

<!--   #choose mosaicVisual() for categorical variables, -->
<!--   #prettierHist() for all others: -->
<!--   visuals = setVisuals( -->
<!--     factor = "mosaicVisual", -->
<!--     numeric = "prettierHist", -->
<!--     integer = "prettierHist",  -->
<!--     Date = "prettierHist" -->
<!--   ),  -->

<!--   #Add the new checkFunction, identifyColons, for character, factor and  -->
<!--   #labelled variables: -->
<!--   checks = setChecks( -->
<!--     character = defaultCharacterChecks(add = "identifyColons"), -->
<!--     factor = defaultFactorChecks(add = "identifyColons"), -->
<!--     labelled = defaultLabelledChecks(add = "identifyColons") -->
<!--   ), -->

<!--   #overwrite old versions of the report, render to html and don't  -->
<!--   #open the html file automatically: -->
<!--   replace = TRUE,  -->
<!--   output = "html", -->
<!--   open = FALSE, -->
<!--   file = here::here("out/dataMaid_mydata.Rmd") -->
<!-- ) -->
<!-- ``` -->




```{r summarytool options 1, eval=FALSE, include=FALSE}
# https://cran.r-project.org/web/packages/summarytools/vignettes/Recommendations-rmarkdown.html
# https://github.com/dcomtois/summarytools
library(knitr)
opts_chunk$set(comment=NA, 
               prompt=FALSE,
               cache=FALSE,
               echo=TRUE,
               results='asis' # add to individual summarytools chunks
               )
```


```{r summarytool options 2, eval=FALSE, include=FALSE}
library(summarytools)
st_css()
```


```{r summarytool options 3, eval=FALSE, include=FALSE}
st_options(bootstrap.css     = FALSE,       # Already part of the theme so no need for it
           plain.ascii       = FALSE,       # One of the essential settings
           style             = "rmarkdown", # Idem.
           dfSummary.silent  = TRUE,        # Suppresses messages about temporary files
           footnote          = NA,          # Keeping the results minimalistic
           subtitle.emphasis = FALSE)       # For the vignette theme, this gives
                                            # much better results. Your mileage may vary.
``` 



```{r summarytools frequencies, eval=FALSE, include=FALSE}
summarytools::freq(iris$Species, plain.ascii = FALSE, style = "rmarkdown")
summarytools::freq(iris$Species, report.nas = FALSE, headings = FALSE, cumul = TRUE, totals = TRUE)
summarytools::freq(tobacco$gender, style = 'rmarkdown')
summarytools::freq(tobacco[ ,c("gender", "age.gr", "smoker")])
```


```{r summarytool frequencies html render, eval=FALSE, include=FALSE}
print(freq(tobacco$gender), method = 'render')
```


```{r summarytools df, eval=FALSE, include=FALSE}
view(dfSummary(iris))
```


```{r summarytools dfs_grid, eval=FALSE, include=FALSE}
dfSummary(tobacco, style = 'grid', graph.magnif = 0.75, tmp.img.dir = "/tmp")
dfSummary(tobacco, plain.ascii = FALSE, style = "grid", 
          graph.magnif = 0.75, valid.col = FALSE, tmp.img.dir = "/tmp")
```


```{r summarytools html, eval=FALSE, include=FALSE}
print(dfSummary(tobacco, graph.magnif = 0.75), method = 'render')
```




```{r summarytools save output, eval=FALSE, include=FALSE}
summarytools::view(mydata,
                   file = here::here("out", "mydata_summary.html")
)
```





```{r explore 1, eval=FALSE, include=FALSE}
# https://github.com/rolkra/explore
# https://cran.r-project.org/web/packages/explore/vignettes/explore.html
# https://cran.r-project.org/web/packages/explore/vignettes/explore_mtcars.html


# library(dplyr)
# library(explore)

explore::explore(mydata)

# iris %>% report(output_file = "report.html", output_dir = here::here())


# iris$is_versicolor <- ifelse(iris$Species == "versicolor", 1, 0)
# iris %>%
#   report(output_file = "report.html",
#          output_dir = here::here(),
#          target = is_versicolor
# # , split = FALSE
# )
```


```{r explore 2, eval=FALSE, include=FALSE, eval=FALSE, include=FALSE}
iris %>% explore::explore_tbl()
mtcars %>% explore::explore_tbl()

iris %>% explore::describe_tbl()

iris %>% explore::explore(Species)
iris %>% explore::explore(Sepal.Length)
iris %>% explore::explore(Sepal.Length, target = is_versicolor)
iris %>% explore::explore(Sepal.Length, target = is_versicolor, split = FALSE)
iris %>% explore::explore(Sepal.Length, target = Species)
iris %>% explore::explore(Sepal.Length, target = Petal.Length)


mtcars %>% 
  explore_all()

iris %>% 
  select(Sepal.Length, Sepal.Width) %>% 
  explore::explore_all()

iris %>% 
  select(Sepal.Length, Sepal.Width, is_versicolor) %>% 
  explore::explore_all(target = is_versicolor)

iris %>% 
  select(Sepal.Length, Sepal.Width, is_versicolor) %>% 
  explore::explore_all(target = is_versicolor, split = FALSE)

iris %>% 
  select(Sepal.Length, Sepal.Width, Species) %>% 
  explore::explore_all(target = Species)

iris %>% 
  select(Sepal.Length, Sepal.Width, Petal.Length) %>% 
  explore::explore_all(target = Petal.Length)
```


```{r explore 3, fig.height=explore::total_fig_height(iris), eval=FALSE, include=FALSE}
iris %>% 
  explore::explore_all()
```


<!-- ```{r explore 4, fig.height='r explore::total_fig_height(iris, target = Species)', eval=FALSE, include=FALSE} -->

<!-- explore::total_fig_height(iris, target = Species) -->

<!-- iris %>% explore::explore_all(target = Species) -->
<!-- ``` -->


```{r explore min-max, eval=FALSE, include=FALSE}
iris %>% explore::explore(Sepal.Length, min_val = 4.5, max_val = 7)
```


```{r explore 5, eval=FALSE, include=FALSE}
iris %>% explore::explore(Sepal.Length, auto_scale = FALSE)
```


```{r explore describe, eval=FALSE, include=FALSE}
mtcars %>% explore::describe()
```




```{r dlookr, eval=FALSE, include=FALSE}
# https://cran.r-project.org/web/packages/dlookr/vignettes/EDA.html

dlookr::describe(carseats
                 # ,
                 # cols = c(statistic)
                 )

# dlookr::describe(carseats, Sales, CompPrice, Income)
# dlookr::describe(carseats, Sales:Income)
# dlookr::describe(carseats, -(Sales:Income))
carseats %>%
  dlookr::describe() %>%
  dplyr::select(variable, skewness, mean, p25, p50, p75) %>% 
  dplyr::filter(!is.na(skewness)) %>% 
  arrange(desc(abs(skewness)))
```



```{r dlookr EDA Report pdf, eval=FALSE, include=FALSE}
# https://cran.r-project.org/web/packages/dlookr/vignettes/EDA.html

carseats %>%
  dlookr::eda_report(target = Sales,
                     output_format = "pdf",
             output_file = "EDA.pdf"
             )
```



```{r dlookr EDA Report html, eval=FALSE, include=FALSE}
carseats %>%
  dlookr::eda_report(target = Sales,
             output_format = "html",
             output_file = "EDA.html"
             )
```



```{r SmartEDA ExpData, eval=FALSE, include=FALSE}
# install.packages("ISLR")
library("ISLR")
# install.packages("SmartEDA")
library("SmartEDA")
## Load sample dataset from ISLR pacakge
Carseats <- ISLR::Carseats

## overview of the data; 
SmartEDA::ExpData(data=Carseats,type=1)
## structure of the data    
SmartEDA::ExpData(data=Carseats,type=2)


```














# Information value



```{r SmartEDA variable importance based on Information value, eval=FALSE, include=FALSE}
# Variable importance based on Information value
SmartEDA::ExpCatStat(
  Carseats,
  Target = "Urban",
  result = "Stat",
  clim = 10,
  nlim = 5,
  bins = 10,
  Pclass = "Yes",
  plot = TRUE,
  top = 10,
  Round = 2
)
```


# Feature imbalance


```{r Feature imbalance inspectdf, eval=FALSE, include=FALSE}
inspectdf::inspect_imb(starwars)

inspectdf::inspect_imb(starwars) %>% inspectdf::show_plot()

inspectdf::inspect_imb(star_1, star_2)

inspectdf::inspect_imb(star_1, star_2) %>% inspectdf::show_plot()
```




# Memory usage
  
```{r memory usage inspectdf, eval=FALSE, include=FALSE}
inspectdf::inspect_mem(starwars)

inspectdf::inspect_mem(starwars) %>% inspectdf::show_plot()

inspectdf::inspect_mem(star_1, star_2)

inspectdf::inspect_mem(star_1, star_2) %>% inspectdf::show_plot()
```

















---

# SmartEDA

Create HTML EDA report

Create a exploratory data analysis report in HTML format

    ExpReport(Carseats,Target="Urban",label=NULL,theme="Default",op_file="test.html",op_dir=getwd(),sc=2,
    sn=2,Rc="Yes")

Quantile-quantile plot for numeric variables

    ExpOutQQ(CData,nlim=10,fname=NULL,Page=c(2,2),sample=4)

Parallel Co-ordinate plots

## Defualt ExpParcoord funciton
    ExpParcoord(CData,Group=NULL,Stsize=NULL,Nvar=c("Price","Income","Advertising","Population","Age",
    "Education"))
## With Stratified rows and selected columns only
  ExpParcoord(CData,Group="ShelveLoc",Stsize=c(10,15,20),Nvar=c("Price","Income"),Cvar=c("Urban","US"))
## Without stratification
  ExpParcoord(CData,Group="ShelveLoc",Nvar=c("Price","Income"),Cvar=c("Urban","US"),scale=NULL)

Exploratory analysis - Custom tables, summary statistics

Descriptive summary on all input variables for each level/combination of group variable. Also while running the analysis we can filter row/cases of the data.

    ExpCustomStat(Carseats,Cvar=c("US","Urban","ShelveLoc"),gpby=FALSE)
    ExpCustomStat(Carseats,Cvar=c("US","Urban"),gpby=TRUE,filt=NULL)
    ExpCustomStat(Carseats,Cvar=c("US","Urban","ShelveLoc"),gpby=TRUE,filt=NULL)
    ExpCustomStat(Carseats,Cvar=c("US","Urban"),gpby=TRUE,filt="Population>150")
    ExpCustomStat(Carseats,Cvar=c("US","ShelveLoc"),gpby=TRUE,filt="Urban=='Yes' & Population>150")



ExpCustomStat(Carseats,Cvar=c("US","Urban","ShelveLoc","Education"),gpby=FALSE)


ExpCTable(Carseats,Target=NULL,clim=5,nlim=15,round=2,bin=NULL,per=F)

ExpCustomStat(Carseats,Cvar=c("US","Urban","ShelveLoc"),gpby=FALSE)

ExpCustomStat(Carseats,Cvar=c("US","Urban"),gpby=TRUE,filt=NULL)

ExpCustomStat(Carseats,Cvar=c("US","Urban","ShelveLoc"),gpby=TRUE,filt=NULL)

ExpCustomStat(Carseats,Cvar=c("US","Urban"),gpby=TRUE,filt="Population>150")

ExpCustomStat(Carseats,Cvar=c("US","ShelveLoc"),gpby=TRUE,filt="Urban=='Yes' & Population>150")

options(width = 150)
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('Count','mean','sum','var','sd','min','max','IQR'))

ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('min','p0.25','median','p0.75','max'))

options(width = 150)
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('Count','mean','sum','var','min','median','max'),filt="Urban=='Yes'")

options(width=150)
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('Count','mean','sum','median','IQR'),filt="Urban=='Yes' & Population>150")

data_sam = Carseats[,]
data_sam[sample(1:400,30),"Sales"] <- 999
data_sam[sample(1:400,20),"CompPrice"] <- -9
data_sam[sample(1:400,45),"Income"] <- 999
ExpCustomStat(data_sam,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('Count','mean','sum','min'),filt="All %ni% c(999,-9)")

options(width = 150)
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Education","Income"),stat = c('Count','mean','sum','var','sd','IQR','median'),filt=c("ShelveLoc=='Good'^Urban=='Yes'^Price>=150^All^US=='Yes'"))

options(width = 150)
ExpCustomStat(Carseats,Cvar = c("Urban","ShelveLoc"), Nvar=c("Population","Sales"), stat = c('Count','Prop','mean','min','P0.25','median','p0.75','max'),gpby=FALSE)

options(width = 150)
ExpCustomStat(Carseats,Cvar = c("Urban","US","ShelveLoc"), Nvar=c("CompPrice","Income"), stat = c('Count','Prop','mean','sum','PS','min','max','IQR','sd'), gpby = TRUE)

options(width = 150)
ExpCustomStat(Carseats,Cvar = c("Urban","US","ShelveLoc"), Nvar=c("CompPrice","Income"), stat = c('Count','Prop','mean','sum','PS','median','IQR'), gpby = TRUE,filt="Urban=='Yes'")

options(width = 150)
data_sam = Carseats[,]
data_sam[sample(1:400,30),"Sales"] <- 888
data_sam[sample(1:400,20),"CompPrice"] <- 999
data_sam[sample(1:400,45),"Income"] <- 999
ExpCustomStat(data_sam,Cvar = c("Urban","US","ShelveLoc"), Nvar=c("Sales","CompPrice","Income"), stat = c('Count','Prop','mean','sum','PS'), gpby = TRUE,filt="All %ni% c(888,999)")

ExpCustomStat(Carseats,Cvar = c("Urban","US"), Nvar=c("Population","Sales","CompPrice"), stat = c('Count','Prop','mean','sum','var','IQR'), filt=c("ShelveLoc=='Good'^Urban=='Yes'^Price>=150"))

options(width = 150)
ExpCustomStat(Carseats,Cvar = c("Urban"), Nvar=c("Population","Sales"), stat = c('Count','Prop'),gpby=TRUE,dcast=TRUE)

##Frequency table for categorical variables
ExpCustomStat(Carseats,Cvar=c("US","Urban","ShelveLoc"),gpby=FALSE)

##Crosstabulation between categorical variables
ExpCustomStat(Carseats,Cvar=c("US","Urban"),gpby=TRUE,filt=NULL)
ExpCustomStat(Carseats,Cvar=c("US","Urban","ShelveLoc"),gpby=TRUE,filt=NULL)

##Adding filters for custom tables
ExpCustomStat(Carseats,Cvar=c("US","Urban"),gpby=TRUE,filt="Population>150")
ExpCustomStat(Carseats,Cvar=c("US","ShelveLoc"),gpby=TRUE,filt="Urban=='Yes' & Population>150")

## Numeric variable summary
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('Count','mean','sum','var','min','max'))
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('min','p0.25','median','p0.75','max'))

## Adding filters for complete data (like base Subset)
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('Count','mean','sum','var'),filt="Urban=='Yes'")
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('Count','mean','sum'),filt="Urban=='Yes' & Population>150")

## Filter unique value from all the numeric variables
ExpCustomStat(data_sam,Nvar=c("Population","Sales","CompPrice","Income"),stat = c('Count','mean','sum','min'),filt="All %ni% c(999,-9)")

## Adding filters at variable level
ExpCustomStat(Carseats,Nvar=c("Population","Sales","CompPrice","Education","Income"),stat = c('Count','mean','sum','var','sd','IQR','median'),filt=c("ShelveLoc=='Good'^Urban=='Yes'^Price>=150^ ^US=='Yes'"))

##Numerical summaries by category
##Variable summary report (One group variable)
ExpCustomStat(Carseats,Cvar = c("Urban","ShelveLoc"), Nvar=c("Population","Sales"), stat = c('Count','Prop','mean','min','P0.25','median','p0.75','max'),gpby=FALSE)

##Variable summary report (More than One group variable)
ExpCustomStat(Carseats,Cvar = c("Urban","US","ShelveLoc"), Nvar=c("CompPrice","Income"), stat = c('Count','Prop','mean','sum','PS','min','max','IQR','sd'), gpby = TRUE)

##Variable summary report (More than One group variable) with filter
ExpCustomStat(Carseats,Cvar = c("Urban","US","ShelveLoc"), Nvar=c("CompPrice","Income"), stat = c('Count','Prop','mean','sum','PS','P0.25','median','p0.75'), gpby = TRUE,filt="Urban=='Yes'")
ExpCustomStat(data_sam,Cvar = c("Urban","US","ShelveLoc"), Nvar=c("Sales","CompPrice","Income"), stat = c('Count','Prop','mean','sum','PS'), gpby = TRUE,filt="All %ni% c(888,999)")
ExpCustomStat(Carseats,Cvar = c("Urban","US"), Nvar=c("Population","Sales","CompPrice"), stat = c('Count','Prop','mean','sum','var','min','max'), filt=c("ShelveLoc=='Good'^Urban=='Yes'^Price>=150"))















