---
title: "GASTROİNTESTİNAL SİSTEMİN CMV ENFEKSİYONU VE HASTALIĞINI SAPTAMADA FARKLI KLİNİK VE MORFOLOİK BULGULARIN PREDİKTİF DEĞERİ"
author: "Burcu Saka, Elif Çalış, Mustafa Salih Akın, Bahadır Ceylan, Esin Yıldız, Gökhan Baysoy"
date: "`r format(Sys.Date())`"
output:
  word_document: default
  pdf_document: default
  html_notebook:
    highlight: kate
    theme: readable
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width = 12, fig.height = 8, fig.path = 'Figs/', echo = FALSE, warning = FALSE, message = FALSE, error = FALSE, eval = TRUE, tidy = TRUE, comment = NA)
```

```{r library, include=FALSE}
library(tidyverse)
```


---

# Amaç


**Amaç**

Sitomegalovirus (CMV) enfeksiyonunun gastrointestinal sistem (GİS) bulguları çeşitlidir ve aralarında malignitenin de olduğu birçok hastalığı taklit edebilir. Günümüzde immünsuprese hasta sayısının giderek arttığı ve enfeksiyonun tanısındaki altın standartın biyopside sitopatik etki varlığı ve/veya immunhistokimyasal (İHKsal) incelemede saptanan pozitiflik olduğu düşünüldüğünde tanı için yol gösterici klinik ve morfolojik bulguları tanımak önem kazanmakta ve tedavide yol gösterici olmaktadır.


---


# Materyal ve Metod

*Materyal ve Metod*

XX-XX tarihleri arasında XX adet CMV pozitif, XX adet CMV negatif vaka tespit edildi. CMV pozitif vakaların tümü ile yaklaşık aynı sayıda (62 olgu) CMV negatif vaka basit randomize örnekleme ile tespit edildi.

102 biopsies from 81 cases were collected representing 74 patients . More than 1 concurrrent biopsy was examined in 16 cases 
    
Merkezimizde xx2014-xx2018 tarihleri arasındaki, patoloji raporları ‘CMV’ kelimesi açısından taranmıştır. Böylelikle çalışmaya CMV tanısı alanlar yanısıra, CMV ön tanısı olanlar ve/veya İHKsı uygulananlar da dahil edilmiştir. xx adet kayıt bulunmuş, GİS’e ait olmayan xx sı çalışma dışı bırakılmıştır. Bu xx adet kayıda ait, yaş, cinsiyet, özgeçmiş, ön tanılar, semptomlar, endoskopik/kolonoskopik ve morfolojik bulgular ve CMV tedavisi alıp almadıkları dökümante edilmiştir. Tipik sitopatik etki varlığı ve/veya İHK pozitifliği, ‘CMV enfeksiyonu’, tedaviyi hakedenler ‘CMV hastalığı’ kabul edilmiş, CMV enfeksiyonu/hastalığı saptananlar ve  saptanmayanlar arası farklılıklar araştırılmıştır. 

2014 ocak ayından bu yana, patoloji raporunda ( tanı, ön tanı, her hangi bir alanda) cmv kelimesi geçen vaka sayısı: 465 included+ 133 excluded= 598  
Bunlardan gise ait olmayanların saysı ( kc, beyin, plasenta, akciğer vb) : 133
GİSe ait olanların sayısı (serdara gönderdiğim sample seçme listesi) : 465
Bunlardan bir şekilde pozitif / şüpheli-zayıf pozitif kelimesi ya da net cmv koliti tanısı geçen sayısı: 68 vaka ??? +- 3 netleştir ( ilknurun dediği 2 vakayı ve eç ile tararken ortaya çıkan bir vakayı bul) 
Geriye Kalanların (negatiflerin) sayısı: ………


---

```{r random selection, eval=FALSE, include=FALSE}
set.seed(2017)

library(readxl)
cmv <- read_excel("Desktop/cmv tüm vakalar serdar.xlsx")
View(cmv)

names(cmv) <- c(names(cmv)[1:2], "cmv")

table(cmv$cmv)

library(tidyverse)

sampleCMV <- cmv %>% 
    filter(cmv == 'negatif') %>% 
    sample_n(60)

writexl::write_xlsx(x = sampleCMV, path = "sampleCMV.xlsx")
```

---


```{r data import, include=FALSE}
library(readxl)
cmv_ihc_data <- read_excel("MDL332 - cmv istatistiğe giden excel.xls")

cmv_ihc_data <- tibble::rowid_to_column(cmv_ihc_data, "subject")


```


```{r convert all to character, include=FALSE}
# glimpse(cmv_ihc_data)

cmv_ihc_data <- purrr::map_df(cmv_ihc_data, as.character)

```


```{r change column names 1, include=FALSE}

to.plain <- function(s) {
        # 1 character substitutions
    old1 <- "çğşıüöÇĞŞİÖÜ"
    new1 <- "cgsiuocgsiou"
    s1 <- chartr(old1, new1, s)
    # 2 character substitutions
    old2 <- c("œ", "ß", "æ", "ø")
    new2 <- c("oe", "ss", "ae", "oe")
    s2 <- s1
    for(i in seq_along(old2)) s2 <- gsub(old2[i], new2[i], s2, fixed = TRUE)
    s2
}


names(cmv_ihc_data) <- names(cmv_ihc_data) %>% 
    tolower() %>% 
    to.plain() %>% 
    make.names()

write(names(cmv_ihc_data), "namescmv.txt")

names(cmv_ihc_data) <- c("hastasirano", "hasta.son.tani", "yil", "rapor.no", "kabul.tarihi", "protokol.no", "hasta.adi.soyadi", "cinsiyet", "hasta.tc.kimlik.no", "hasta.yasi", "ozgecmis.kodlari", "eslikci.hastalik.kodlari", "pcr.kodu", "semptom.kodlari", "on.tani.kodlari", "exitus", "oz.endoskopi", "oz.sitopatik", "oz.ihk", "oz.cmv.tani", "oz.apopitoz", "oz.iltihap", "korpus.endoskopi", "korpus.sitopatik", "korpus.ihk", "korpus.cmv.tani", "korpus.apopitoz", "korpus.iltihap", "antrum.endoskopi", "antrum.sitopatik", "antrum.ihk", "antrum.cmv.tani", "antrum.apopitoz", "antrum.iltihap", "duod.endoskopi", "duod.sitopatik", "duod.ihk", "duod.cmv.tani", "duod.apopitoz", "duod.iltihap", "ileum.endoskopi", "ileum.sitopatik", "ileum.ihk", "ileum.cmv.tani", "ileum.apopitoz", "ileum.iltihap", "cekum.endoskopi", "cekum.sitopatik", "cekum.ihk", "cekum.cmv.tani", "cekum.apopitoz", "cekum.iltihap", "cikan.endoskopi", "cikan.sitopatik", "cikan.ihk", "cikan.cmv.tani", "cikan.apopitoz", "cikan.iltihap", "transvers.endoskopi", "transvers.sitopatik", "transvers.ihk", "transvers.cmv.tani", "transvers.apopitoz", "transvers.iltihap", "inen.endoskopi", "inen.sitopatik", "inen.ihk", "inen.cmv.tani", "inen.apopitoz", "inen.iltihap", "sigmoid.endoskopi", "sigmoid.sitopatik", "sigmoid.ihk", "sigmoid.cmv.tani", "sigmoid.apopitoz", "sigmoid.iltihap", "rektum.endoskopi", "rektum.sitopatik", "rektum.ihk", "rektum.cmv.tani", "rektum.apopitoz", "rektum.iltihap")

```

189 bx from 119 patients (M: 76, F: 43), mean age: 46.3 +/- 23.2 (min:3, mac:82).
41 patients had more than one bx.


```{r patient characteristics, include=TRUE}

dim(cmv_ihc_data)



patients <- cmv_ihc_data %>% 
    select(cinsiyet = cinsiyet,
           yas = hasta.yasi
    )

patients$yas <- as.numeric(patients$yas)

jmv::descriptives(data = patients,
                  vars = c("cinsiyet", "yas"),
                  freq = TRUE,
                  sd = TRUE)
```



<!-- veriyi organlara gore bol -->

```{r ozefagus, include=FALSE}
oz <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("oz")) %>% 
    filter(
        !is.na(oz.endoskopi) |
        !is.na(oz.sitopatik) |
        !is.na(oz.ihk) |
        !is.na(oz.cmv.tani) |
        !is.na(oz.apopitoz) |
        !is.na(oz.iltihap)
) %>% 
    rename(endoskopi = oz.endoskopi,
sitopatik = oz.sitopatik,
ihk = oz.ihk,
cmv.tani = oz.cmv.tani,
apopitoz = oz.apopitoz,
iltihap = oz.iltihap)
```

```{r mide korpus, include=FALSE}
korpus <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("korpus")) %>% 
    filter(
        !is.na(korpus.endoskopi) |
        !is.na(korpus.sitopatik) |
        !is.na(korpus.ihk) |
        !is.na(korpus.cmv.tani) |
        !is.na(korpus.apopitoz) |
        !is.na(korpus.iltihap)
) %>% 
    rename(endoskopi = korpus.endoskopi,
sitopatik = korpus.sitopatik,
ihk = korpus.ihk,
cmv.tani = korpus.cmv.tani,
apopitoz = korpus.apopitoz,
iltihap = korpus.iltihap)
```


```{r antrum, include=FALSE}
antrum <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("antrum")) %>% 
    filter(
        !is.na(antrum.endoskopi) |
        !is.na(antrum.sitopatik) |
        !is.na(antrum.ihk) |
        !is.na(antrum.cmv.tani) |
        !is.na(antrum.apopitoz) |
        !is.na(antrum.iltihap)
) %>% 
    rename(endoskopi = antrum.endoskopi,
sitopatik = antrum.sitopatik,
ihk = antrum.ihk,
cmv.tani = antrum.cmv.tani,
apopitoz = antrum.apopitoz,
iltihap = antrum.iltihap)
```


```{r duodenum, include=FALSE}
duod <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("duod")) %>% 
    filter(
        !is.na(duod.endoskopi) |
        !is.na(duod.sitopatik) |
        !is.na(duod.ihk) |
        !is.na(duod.cmv.tani) |
        !is.na(duod.apopitoz) |
        !is.na(duod.iltihap)
) %>% 
    rename(endoskopi = duod.endoskopi,
sitopatik = duod.sitopatik,
ihk = duod.ihk,
cmv.tani = duod.cmv.tani,
apopitoz = duod.apopitoz,
iltihap = duod.iltihap)
```


```{r ileum, include=FALSE}
ileum <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("ileum")) %>% 
    filter(
        !is.na(ileum.endoskopi) |
        !is.na(ileum.sitopatik) |
        !is.na(ileum.ihk) |
        !is.na(ileum.cmv.tani) |
        !is.na(ileum.apopitoz) |
        !is.na(ileum.iltihap)
) %>% 
    rename(endoskopi = ileum.endoskopi,
sitopatik = ileum.sitopatik,
ihk = ileum.ihk,
cmv.tani = ileum.cmv.tani,
apopitoz = ileum.apopitoz,
iltihap = ileum.iltihap)
```


```{r cekum, include=FALSE}
cekum <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("cekum")) %>% 
    filter(
        !is.na(cekum.endoskopi) |
        !is.na(cekum.sitopatik) |
        !is.na(cekum.ihk) |
        !is.na(cekum.cmv.tani) |
        !is.na(cekum.apopitoz) |
        !is.na(cekum.iltihap)
) %>% 
    rename(endoskopi = cekum.endoskopi,
sitopatik = cekum.sitopatik,
ihk = cekum.ihk,
cmv.tani = cekum.cmv.tani,
apopitoz = cekum.apopitoz,
iltihap = cekum.iltihap)
```


```{r cikan kolon, include=FALSE}
cikan <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("cikan")) %>% 
    filter(
        !is.na(cikan.endoskopi) |
        !is.na(cikan.sitopatik) |
        !is.na(cikan.ihk) |
        !is.na(cikan.cmv.tani) |
        !is.na(cikan.apopitoz) |
        !is.na(cikan.iltihap)
) %>% 
    rename(endoskopi = cikan.endoskopi,
sitopatik = cikan.sitopatik,
ihk = cikan.ihk,
cmv.tani = cikan.cmv.tani,
apopitoz = cikan.apopitoz,
iltihap = cikan.iltihap)
```


```{r transvers kolon, include=FALSE}
transvers <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("transvers")) %>% 
    filter(
        !is.na(transvers.endoskopi) |
        !is.na(transvers.sitopatik) |
        !is.na(transvers.ihk) |
        !is.na(transvers.cmv.tani) |
        !is.na(transvers.apopitoz) |
        !is.na(transvers.iltihap)
) %>% 
    rename(endoskopi = transvers.endoskopi,
sitopatik = transvers.sitopatik,
ihk = transvers.ihk,
cmv.tani = transvers.cmv.tani,
apopitoz = transvers.apopitoz,
iltihap = transvers.iltihap)
```


```{r inen kolon, include=FALSE}
inen <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("inen")) %>% 
    filter(
        !is.na(inen.endoskopi) |
        !is.na(inen.sitopatik) |
        !is.na(inen.ihk) |
        !is.na(inen.cmv.tani) |
        !is.na(inen.apopitoz) |
        !is.na(inen.iltihap)
) %>% 
    rename(endoskopi = inen.endoskopi,
sitopatik = inen.sitopatik,
ihk = inen.ihk,
cmv.tani = inen.cmv.tani,
apopitoz = inen.apopitoz,
iltihap = inen.iltihap)
```


```{r sigmoid kolon, include=FALSE}
sigmoid <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("sigmoid")) %>% 
    filter(
        !is.na(sigmoid.endoskopi) |
        !is.na(sigmoid.sitopatik) |
        !is.na(sigmoid.ihk) |
        !is.na(sigmoid.cmv.tani) |
        !is.na(sigmoid.apopitoz) |
        !is.na(sigmoid.iltihap)
) %>% 
    rename(endoskopi = sigmoid.endoskopi,
sitopatik = sigmoid.sitopatik,
ihk = sigmoid.ihk,
cmv.tani = sigmoid.cmv.tani,
apopitoz = sigmoid.apopitoz,
iltihap = sigmoid.iltihap)
```


```{r rektum, include=FALSE}
rektum <- cmv_ihc_data %>% 
    select(hastasirano, hasta.son.tani,
yil,
rapor.no,
cinsiyet,
hasta.yasi,
ozgecmis.kodlari,
eslikci.hastalik.kodlari,
pcr.kodu,
semptom.kodlari,
on.tani.kodlari,
exitus,
starts_with("rektum")) %>% 
    filter(
        !is.na(rektum.endoskopi) |
        !is.na(rektum.sitopatik) |
        !is.na(rektum.ihk) |
        !is.na(rektum.cmv.tani) |
        !is.na(rektum.apopitoz) |
        !is.na(rektum.iltihap)
) %>% 
    rename(endoskopi = rektum.endoskopi,
sitopatik = rektum.sitopatik,
ihk = rektum.ihk,
cmv.tani = rektum.cmv.tani,
apopitoz = rektum.apopitoz,
iltihap = rektum.iltihap)
```


---




---


```{r organlara gore olan verileri birlestir, include=FALSE}

# cat(ls())


tumveri <- bind_rows(oz, korpus, antrum, duod, ileum, cekum, cikan, transvers, inen, sigmoid, rektum, .id = "id")


## Recoding veri2$id into veri2$id_rec
tumveri$lokalizasyon <- recode(tumveri$id,
               "1" = "ozefagus",
               "2" = "korpus",
               "3" = "antrum",
               "4" = "duod",
               "5" = "ileum",
               "6" = "cekum",
               "7" = "cikan",
               "8" = "transvers",
               "9" = "inen",
               "10" = "sigmoid",
               "11" = "rektum")
tumveri$lokalizasyon <- factor(tumveri$lokalizasyon)

## Reordering tumveri$lokalizasyon
tumveri$lokalizasyon <- factor(tumveri$lokalizasyon, levels=c("ozefagus", "korpus", "antrum", "duod", "ileum", "cekum", "cikan", "transvers", "inen", "sigmoid", "rektum"))

```

---

# Tanımlayıcı istatistikler

*Tanımlayıcı istatistikler*

## Lokalizasyon

```{r, lokalizasyon ve grubu, include=TRUE}
table(tumveri$lokalizasyon)

## Recoding tumveri$lokalizasyon into tumveri$lokalizasyon_rec
tumveri$lokalizasyon_rec <- recode(tumveri$lokalizasyon,
               "ozefagus" = "ustGIS",
               "korpus" = "ustGIS",
               "antrum" = "ustGIS",
               "duod" = "ustGIS",
               "ileum" = "altGIS",
               "cekum" = "altGIS",
               "cikan" = "altGIS",
               "transvers" = "altGIS",
               "inen" = "altGIS",
               "sigmoid" = "altGIS",
               "rektum" = "altGIS")


## Reordering tumveri$lokalizasyon_rec
tumveri$lokalizasyon_rec <- factor(tumveri$lokalizasyon_rec, levels=c("ustGIS", "altGIS"))



table(tumveri$lokalizasyon_rec) %>% addmargins()

```

*Birden fazla biyopsi olan vaka sayısı*

```{r birden fazla biyopsi sayısı, include=TRUE}
sum(as.vector(table(tumveri$hastasirano)) > 1)
```


---


## Hastanın CMV durumu

*Hastanın CMV durumu*

<!-- recoding -->

<!-- 1) Vakanın CMV durumu: pozitif :1/ negatif :0/ şüpheli :2 (H&E ve İHK birlikte değerlendirildiğinde son karar) Bu sütunu kullanmanıza ihtiyaç olacak mı emin değilim ama yine de tuttum. Her bir biyopsinin CMV durumunu kendine ait sütun grubunda ayrıca notladım.  -->

```{r CMV durumu, include=FALSE}
# table(tumveri$hasta.son.tani)

## Recoding tumveri$hasta.son.tani into tumveri$hasta.son.tani_rec
tumveri$hasta.son.tani_rec <- recode(tumveri$hasta.son.tani,
               "1" = "positive",
               "2" = "supheli",
               "0" = "negative")
tumveri$hasta.son.tani_rec <- factor(tumveri$hasta.son.tani_rec)
```



```{r hastanın CMV sonucu, include=TRUE}
table(tumveri$hasta.son.tani_rec, dnn = "Hastanın CMV sonucu") %>% 
    addmargins()
```

---

## Özgeçmiş

*Özgeçmiş, altta yatan hastalık*

<!-- 5) özgeçmişi (malignite+ nakil: 1, sadece organ nakli: 2, malignite: 3, immunyetmezlik ( aids ya da diğer iy sendromları: 4, 5: dm, ybü, is tedavi alan-immuran,salozaprin- ibh, steroid hx, 6: immunsupresif tedavi almayan -salofalk-ibh, is bir hastalığı olmayan ) -- Bu hastalardan 1,2,3,4 ve 5: immunsuprese, 6 ise immunkompetan grubu oluşturuyor. -->


```{r altta yatan hastalık, include=FALSE}
# table(tumveri$ozgecmis.kodlari)

## Recoding tumveri$ozgecmis.kodlari into tumveri$ozgecmis.kodlari_rec
tumveri$ozgecmis.kodlari_rec <- recode(tumveri$ozgecmis.kodlari,
               "3" = "Malign",
               "5" = "Diabetes",
               "6" = "immunkompetan",
               "1" = "MalignTrans",
               "2" = "Trans",
               "4" = "AIDS")
tumveri$ozgecmis.kodlari_rec <- factor(tumveri$ozgecmis.kodlari_rec)


## Reordering tumveri$ozgecmis.kodlari_rec
tumveri$ozgecmis.kodlari_rec <- factor(tumveri$ozgecmis.kodlari_rec, levels=c("immunkompetan", "Diabetes", "AIDS", "Malign", "MalignTrans", "Trans"))


```



```{r ozgecmis altta yatan hastalık, include=TRUE}
table(tumveri$ozgecmis.kodlari_rec, dnn = "Altta yatan hastalık") %>% 
    addmargins()
```


---

```{r immunkompetan immunsuprese, include=TRUE}
## Recoding tumveri$ozgecmis.kodlari into tumveri$ozgecmis.kodlari_gr
tumveri$ozgecmis.kodlari_gr <- recode(tumveri$ozgecmis.kodlari,
               "3" = "immunsuprese",
               "5" = "immunsuprese",
               "6" = "immunkompetan",
               "1" = "immunsuprese",
               "2" = "immunsuprese",
               "4" = "immunsuprese")
tumveri$ozgecmis.kodlari_gr <- factor(tumveri$ozgecmis.kodlari_gr)

table(tumveri$ozgecmis.kodlari_gr, dnn = "İmmun sistem durumu") %>% addmargins()

```


---

## Eşlik eden hastalık

*Biyopsisi anında eşlikçi fırsatçı enfeksiyon*

<!-- 6) gastrointestinal sistem biyopsisi alındığı an varsa eşlikçi fırsatçı enfeksiyon  -->
<!--    (var:1/ yok: 0)  -->

```{r eslik eden hastalik, include=FALSE}
table(tumveri$eslikci.hastalik.kodlari)

## Recoding tumveri$eslikci.hastalik.kodlari into tumveri$eslikci.hastalik.kodlari_rec
tumveri$eslikci.hastalik.kodlari_rec <- recode(tumveri$eslikci.hastalik.kodlari,
               "0" = "yok",
               "1" = "var")
tumveri$eslikci.hastalik.kodlari_rec <- factor(tumveri$eslikci.hastalik.kodlari_rec)

## Reordering tumveri$eslikci.hastalik.kodlari_rec
tumveri$eslikci.hastalik.kodlari_rec <- factor(tumveri$eslikci.hastalik.kodlari_rec, levels=c("yok", "var"))

```


```{r, include=TRUE}
table(tumveri$eslikci.hastalik.kodlari_rec, dnn = "Eşlik eden enfeksiyon") %>% 
    addmargins()
```


---

## Serum CMV PCR 

*Serum CMV PCR*

<!-- 7) Kanda CMV PCR sonucu  (negatif: 0, pozitif: 1, bilinmiyor: 2)  -->

```{r serum CMV PCR, include=FALSE}
## Recoding tumveri$pcr.kodu into tumveri$pcr.kodu_rec
tumveri$pcr.kodu_rec <- recode(tumveri$pcr.kodu,
               "1" = "positive",
               "2" = NA_character_,
               "0" = "negative")

tumveri$pcr.kodu_rec <- factor(tumveri$pcr.kodu_rec)

## Reordering tumveri$pcr.kodu_rec
tumveri$pcr.kodu_rec <- factor(tumveri$pcr.kodu_rec, levels=c("negative", "positive"))

```



```{r Serum PCR sonucu, include=TRUE}
table(tumveri$pcr.kodu_rec, dnn = "Serum PCR sonucu") %>% 
    addmargins()
```


---

## Biyopsi endikasyonu

*Biyopsi alınmasına neden olan esas semptom*

<!-- 8) biyopsi alınmasına neden olan esas semptom (asemptomatik: 0, diğer: 1, dispepsi: 2, ishal: 3, kanama: 4, karın ağrısı: 5, bilinmiyorsa: 6)  -->



```{r biyopsi endikasyonu, include=FALSE}
# table(tumveri$semptom.kodlari)

## Recoding tumveri$semptom.kodlari into tumveri$semptom.kodlari_rec
tumveri$semptom.kodlari_rec <- recode(tumveri$semptom.kodlari,
               "3" = "ishal",
               "4" = "kanama",
               "5" = "karin agrisi",
               "2" = "dispepsi",
               "1" = "diger",
               "6" = NA_character_,
               "0" = "asemptomatik")
tumveri$semptom.kodlari_rec <- factor(tumveri$semptom.kodlari_rec)

## Reordering tumveri$semptom.kodlari_rec
tumveri$semptom.kodlari_rec <- factor(tumveri$semptom.kodlari_rec, levels=c("asemptomatik", "diger", "dispepsi", "ishal", "kanama", "karin agrisi"))


```



```{r biyopsi endikasyonu tablo, include=TRUE}
table(tumveri$semptom.kodlari_rec, dnn = "Biyopsi Öncesi Semptom") %>% 
    addmargins()
```


## Semptom

*Semptom Varlığı*

```{r, include=TRUE}
table(tumveri$semptom.kodlari)

## Recoding tumveri$semptom.kodlari_rec into tumveri$semptom_rec2
tumveri$semptom_rec2 <- recode(tumveri$semptom.kodlari_rec,
               "diger" = "semptomatik",
               "dispepsi" = "semptomatik",
               "ishal" = "semptomatik",
               "kanama" = "semptomatik",
               "karin agrisi" = "semptomatik")

## Reordering tumveri$semptom_rec2
tumveri$semptom_rec2 <- factor(tumveri$semptom_rec2, levels=c("asemptomatik", "semptomatik"))

table(tumveri$semptom_rec2, dnn = "Semptom Varlığı") %>% addmargins()

```


---


---

## Klinik Ön Tanı

*CMV klinik ön tanısı*

<!-- 9) biyopsideki ön tanıda CMV varlığı (var: 1, yok:0, ön tanı belirtilmemişse: 2)    -->


```{r klinik on tani, include=FALSE}
# table(tumveri$on.tani.kodlari)

## Recoding tumveri$on.tani.kodlari into tumveri$on.tani
tumveri$on.tani <- recode(tumveri$on.tani.kodlari,
               "0" = "yok",
               "1" = "var",
               "2" = NA_character_)
tumveri$on.tani <- factor(tumveri$on.tani)

## Reordering tumveri$on.tani
tumveri$on.tani <- factor(tumveri$on.tani, levels=c("yok", "var"))

```



```{r Klinik On Tani Tablo, include=TRUE}
table(tumveri$on.tani, dnn = "Klinik Ön Tanı") %>% 
    addmargins()
```

---

## Endoskopik bulgu

<!-- 10) alınan biyopsinin lokalizasyonu ve bu lokalizasyona ait özellikler:  -->

*Endoskopik bulgular*

<!-- a) endoskopik bulgu :  -->
<!-- normal: 0  -->
<!-- eksudalı, aftöz, membranlı, plak tarzı ülser: 1 -->
<!-- zımba deliği şeklinde, derin ülser: 2 -->
<!-- dev ülser: 3  -->
<!-- erozyon, frajil, ödem, hiperemi: 4  -->
<!-- değişik nadir durumlar: 5  -->
<!-- polip/ psödopolip: 6  -->
<!-- bilinmiyorsa: na   -->

```{r endoskopik bulgu, include=FALSE}
# table(tumveri$endoskopi)

## Recoding tumveri$endoskopi into tumveri$endoskopi_rec
tumveri$endoskopi_rec <- recode(tumveri$endoskopi,
               "5" = "diger",
               "1" = "plak ulser",
               "2" = "derin ulser",
               "0" = "normal",
               "4" = "erezyon",
               "6" = "polip",
               "na" = NA_character_,
               "3" = "dev ulser")
tumveri$endoskopi_rec <- factor(tumveri$endoskopi_rec)


## Reordering tumveri$endoskopi_rec
tumveri$endoskopi_rec <- factor(tumveri$endoskopi_rec, levels=c("normal", "erezyon", "plak ulser", "derin ulser", "dev ulser", "polip", "diger"))

```



```{r Endoskopi Bulguları 1, include=TRUE}
table(tumveri$endoskopi_rec, dnn = "Endoskopi Bulguları") %>% 
    addmargins()
```

```{r endoskopi var yok, include=FALSE}

## Recoding tumveri$endoskopi_rec into tumveri$endoskopi_rec2
tumveri$endoskopi_rec2 <- recode(tumveri$endoskopi_rec,
               "erezyon" = "var",
               "plak ulser" = "var",
               "derin ulser" = "var",
               "dev ulser" = "var",
               "polip" = "var",
               "diger" = "var")

## Reordering tumveri$endoskopi_rec2
tumveri$endoskopi_rec2 <- factor(tumveri$endoskopi_rec2, levels=c("normal", "var"))

```


```{r Endoskopi Bulguları 2, include=TRUE}
table(tumveri$endoskopi_rec2, dnn = "Endoskopi Bulguları") %>% 
    addmargins()
```


```{r endoskopi yok var ulser, include=FALSE}

## Recoding tumveri$endoskopi_rec into tumveri$endoskopi_rec3
tumveri$endoskopi_rec3 <- recode(tumveri$endoskopi_rec,
               "erezyon" = "var",
               "plak ulser" = "ulser",
               "derin ulser" = "ulser",
               "dev ulser" = "ulser",
               "polip" = "var",
               "diger" = "var")

## Reordering tumveri$endoskopi_rec3
tumveri$endoskopi_rec3 <- factor(tumveri$endoskopi_rec3, levels=c("normal", "var", "ulser"))

```


```{r Endoskopi Bulguları, include=TRUE}
table(tumveri$endoskopi_rec3, dnn = "Endoskopi Bulguları") %>% 
    addmargins()
```



---

## Sitopatik Etki

*H&E de CMV sitopatik etkisi*

<!-- b) H&E de CMV sitopatik etkisi ve yeri :  -->
<!-- yok:0  -->
<!-- şüpheli:1 -->
<!-- endotelde: 2 -->
<!-- epitelde: 3 -->
<!-- fibroblastta: 4  -->
<!-- Ya da kombinasyonları  -->

```{r H&E sitopatik etki, include=FALSE}
# table(tumveri$sitopatik)

## Recoding tumveri$sitopatik into tumveri$sitopatik_rec
tumveri$sitopatik_rec <- recode(tumveri$sitopatik,
               "3" = "epitel",
               "2" = "endotel",
               "0" = "yok",
               "2 ve 3" = "endotel ve epitel",
               "1" = "supheli",
               "3 ve 4" = "epitel ve fibroblast",
               "2 ve 4" = "endotel ve fibroblast",
               "4" = "fibroblast")
tumveri$sitopatik_rec <- factor(tumveri$sitopatik_rec)

## Reordering tumveri$sitopatik_rec
tumveri$sitopatik_rec <- factor(tumveri$sitopatik_rec, levels=c("yok", "endotel", "epitel", "fibroblast", "endotel ve epitel", "endotel ve fibroblast", "epitel ve fibroblast", "supheli"))

```


```{r Sitopatik Etkinin İzlendiği Hücre, include=TRUE}
table(tumveri$sitopatik_rec, dnn = "Sitopatik Etkinin Izlendigi Hucre") %>% 
    addmargins()
```



<!-- yok, tek grup hücre, çok hücre -->

```{r sitopatik etki hucre grubu, include=FALSE}
## Recoding tumveri$sitopatik_rec into tumveri$sitopatik_rec2
tumveri$sitopatik_rec2 <- recode(tumveri$sitopatik_rec,
               "endotel" = "tek grup hucre",
               "epitel" = "tek grup hucre",
               "fibroblast" = "tek grup hucre",
               "endotel ve epitel" = "birden cok farkli hucre",
               "endotel ve fibroblast" = "birden cok farkli hucre",
               "epitel ve fibroblast" = "birden cok farkli hucre")

tumveri$sitopatik_rec2 <- factor(tumveri$sitopatik_rec2)


## Reordering tumveri$sitopatik_rec2
tumveri$sitopatik_rec2 <- factor(tumveri$sitopatik_rec2, levels=c("yok", "tek grup hucre", "birden cok farkli hucre", "supheli"))


```





```{r Sitopatik Etkinin İzlendiği Hücre 2, include=TRUE}
table(tumveri$sitopatik_rec2, dnn = "Sitopatik Etkinin Izlendigi Hucre Grupları") %>% 
    addmargins()
```


<!-- yok, var -->

```{r sitopatik etki varligi, include=FALSE}
## Recoding tumveri$sitopatik_rec2 into tumveri$sitopatik_rec3
tumveri$sitopatik_rec3 <- recode(tumveri$sitopatik_rec2,
               "tek grup hucre" = "var",
               "birden cok farkli hucre" = "var",
               "supheli" = "var")

tumveri$sitopatik_rec3 <- factor(tumveri$sitopatik_rec3)

## Reordering tumveri$sitopatik_rec3
tumveri$sitopatik_rec3 <- factor(tumveri$sitopatik_rec3, levels=c("yok", "var"))

```




```{r Sitopatik etki varligi tablo, include=TRUE}
table(tumveri$sitopatik_rec3, dnn = "Sitopatik etki Varligi")
```


---

## CMV IHK

*CMV immunhistokimyası*


<!-- c) CMV immunhistokimyasının sonucu:   -->
<!-- negatif:0  -->
<!-- pozitif: 1 -->
<!-- şüpheli: 2   -->
<!-- ( Şüpheli de pozitif içinde değerlendirilebilir. ) -->


```{r CMV IHK 1, include=FALSE}
## Recoding tumveri$ihk into tumveri$ihk_rec
tumveri$ihk_rec <- recode(tumveri$ihk,
               "0" = "negative",
               "1" = "positive",
               "2" = "positive",
               "pozitif" = "positive")
tumveri$ihk_rec <- factor(tumveri$ihk_rec)

## Reordering tumveri$ihk_rec
tumveri$ihk_rec <- factor(tumveri$ihk_rec, levels=c("negative", "positive"))


```




```{r CMV IHK, include=TRUE}
table(tumveri$ihk_rec, dnn = "CMV IHK sonucu") %>% 
    addmargins()
```


---

## CMV durumu

*H&E ve İHK sonunda biyopsinin CMV durumu*

<!-- d) H&E ve İHK sonunda biyopsinin CMV durumu: pozitif :1/ negatif :0/ şüpheli :2 -->

```{r , include=FALSE}
## Recoding tumveri$cmv.tani into tumveri$cmv.tani_rec
tumveri$cmv.tani_rec <- recode(tumveri$cmv.tani,
               "1" = "positive",
               "2" = "positive",
               "0" = "negative")
tumveri$cmv.tani_rec <- factor(tumveri$cmv.tani_rec)

## Reordering tumveri$cmv.tani_rec
tumveri$cmv.tani_rec <- factor(tumveri$cmv.tani_rec, levels=c("negative", "positive"))


```


```{r CMV Tani, include=TRUE}
table(tumveri$cmv.tani_rec, dnn = "CMV Tanı") %>% 
    addmargins()
```


---

## Apopitoz

*Apopitoz*

<!-- e)  apopitoz (0: yok/ net değil, 1: seyrek var, 2: seyrekten çok, 3: apopitotik kript absesi var)  -->
<!-- Ayrı ayrı gruplar ile biryere varılamaz ise 0 ve diğerleri olarak gruplanabilir.  -->

```{r Apopitoz Sekli 1, include=FALSE}
## Recoding tumveri$apopitoz into tumveri$apopitoz_rec
tumveri$apopitoz_rec <- recode(tumveri$apopitoz,
               "0" = "yok",
               "1" = "seyrek",
               "2" = "var",
               "3" = "kript absesi")
tumveri$apopitoz_rec <- factor(tumveri$apopitoz_rec)

## Reordering tumveri$apopitoz_rec
tumveri$apopitoz_rec <- factor(tumveri$apopitoz_rec, levels=c("yok", "seyrek", "var", "kript absesi"))

```



```{r Apopitoz Sekli, include=TRUE}
table(tumveri$apopitoz_rec, dnn = "Apopitoz Sekli") %>% 
    addmargins()
```


```{r Apopitoz Varligi 1, include=FALSE}
## Recoding tumveri$apopitoz into tumveri$apopitoz_rec2
tumveri$apopitoz_rec2 <- recode(tumveri$apopitoz,
               "0" = "yok",
               "1" = "var",
               "2" = "var",
               "3" = "var")
tumveri$apopitoz_rec2 <- factor(tumveri$apopitoz_rec2)

## Reordering tumveri$apopitoz_rec2
tumveri$apopitoz_rec2 <- factor(tumveri$apopitoz_rec2, levels=c("yok", "var"))

```



```{r Apopitoz varligi, include=TRUE}
table(tumveri$apopitoz_rec2, dnn = "Apopitoz varlığı") %>% 
    addmargins()
```


---

## İltihap Miktarı

*İltihap miktarı*

<!-- f) iltihap miktarı (0: iltihap yok, 1: iltihabi granülasyon dokusu, 2: granülasyon dokusu izlenmeksizin yalnızca itihabi eksuda, 3: fokal aktif inflamasyon, 4: orta şiddette aktif inflamasyon; 5: (ülsersiz) şiddetli aktif inflamasyon )  -->
<!-- Bunlardan 1 ve 2 ülser varlığına, 3, 4 ve 5 ülser yokluğuna işaret ediyor. (Ayrı ayrı gruplarla bir sonuca varılamaz ise, gruplayarak bakmak daha iyi olabilir.)  -->


```{r iltihap miktari 1, include=FALSE}
## Recoding tumveri$iltihap into tumveri$iltihap_rec
tumveri$iltihap_rec <- recode(tumveri$iltihap,
               "2" = "eksuda",
               "1" = "granulasyon dokusu",
               "0" = "yok",
               "5" = "siddetli aktif",
               "3" = "fokal aktif",
               "4" = "orta aktif")
tumveri$iltihap_rec <- factor(tumveri$iltihap_rec)

## Reordering tumveri$iltihap_rec
tumveri$iltihap_rec <- factor(tumveri$iltihap_rec, levels=c("yok", "granulasyon dokusu", "eksuda", "fokal aktif", "orta aktif", "siddetli aktif"))

```



```{r inflamasyon, include=TRUE}
table(tumveri$iltihap_rec, dnn = "İnflamasyon şekli") %>% 
    addmargins()
```


```{r iltihap miktari 2, include=FALSE}
## Recoding tumveri$iltihap into tumveri$iltihap_rec
tumveri$iltihap_rec2 <- recode(tumveri$iltihap,
               "2" = "ulserli",
               "1" = "ulserli",
               "0" = "yok",
               "5" = "ulsersiz",
               "3" = "ulsersiz",
               "4" = "ulsersiz")
tumveri$iltihap_rec2 <- factor(tumveri$iltihap_rec2)

## Reordering tumveri$iltihap_rec
tumveri$iltihap_rec2 <- factor(tumveri$iltihap_rec2, levels=c("yok", "ulsersiz", "ulserli"))

```



```{r inflamasyon 2, include=TRUE}
table(tumveri$iltihap_rec2, dnn = "İnflamasyon şekli") %>% 
    addmargins()
```


## Cinsiyet

*Cinsiyet*

```{r, include=FALSE}
tumveri$cinsiyet <- as.factor(tumveri$cinsiyet)
```



```{r cinsiyet, include=TRUE}
table(tumveri$cinsiyet, dnn = "Cinsiyet")
```

## Yaş

*Yaş*

```{r, include=TRUE}
tumveri$hasta.yasi <- as.numeric(tumveri$hasta.yasi)

summary(tumveri$hasta.yasi)

```


```{r, include=TRUE}
# names(tumveri)
jmv::descriptives(
    data = tumveri,
    vars = c("hasta.yasi"),
    freq = FALSE,
    n = TRUE,
    missing = FALSE,
    mean = TRUE,
    median = TRUE,
    min = TRUE,
    max = TRUE, 
    sd = TRUE, 
    hist = TRUE,
    dens = TRUE, 
    mode = TRUE
    )
```






# Frekans Tabloları

**Frekans Tabloları**

```{r, include=TRUE}
# names(tumveri)
jmv::descriptives(
    data = tumveri,
    vars = c("cinsiyet",
            "lokalizasyon",
            "lokalizasyon_rec",
            "hasta.son.tani_rec",
            "ozgecmis.kodlari_rec",
            "ozgecmis.kodlari_gr",
            "eslikci.hastalik.kodlari_rec",
            "pcr.kodu_rec",
            "semptom.kodlari_rec",
            "semptom_rec2",
            "on.tani",
             "endoskopi_rec",
            "endoskopi_rec2",
            "endoskopi_rec3",
            "sitopatik_rec",
            "sitopatik_rec2",
            "sitopatik_rec3",
            "ihk_rec",
            "cmv.tani_rec",
            "apopitoz_rec",
            "apopitoz_rec2",
            "iltihap_rec",
            "iltihap_rec2"),
    freq = TRUE,
    n = FALSE,
    missing = FALSE,
    mean = FALSE,
    median = FALSE,
    min = FALSE,
    max = FALSE
    ) 
```


# Table One

```{r tangram table one, eval=FALSE, include=FALSE}
# names(tumveri)
# library(tangram)
tangram::tangram(1 ~ cinsiyet + hasta.yasi+ lokalizasyon + lokalizasyon_rec +
                     hasta.son.tani_rec +
            ozgecmis.kodlari_rec+
            ozgecmis.kodlari_gr+
            eslikci.hastalik.kodlari_rec+
            pcr.kodu_rec+
            semptom.kodlari_rec+
                semptom_rec2+
            on.tani+
             endoskopi_rec+
                endoskopi_rec2+
                endoskopi_rec3+
            sitopatik_rec+
            sitopatik_rec2+
            sitopatik_rec3+
            ihk_rec+
            cmv.tani_rec+
            apopitoz_rec+
            apopitoz_rec2+
            iltihap_rec+
            iltihap_rec2,
                      tumveri, test=FALSE)

```


```{r tangram table one percent, eval=FALSE, include=FALSE}
summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) }
assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram")
tangram::tangram(1 ~ cinsiyet +
                     hasta.yasi+
                     lokalizasyon[1] +
            ozgecmis.kodlari_rec[1]+
            ozgecmis.kodlari_gr[1]+
            eslikci.hastalik.kodlari_rec[1]+
            pcr.kodu_rec[1]+
            semptom.kodlari_rec[1]+
                semptom_rec2[1]+
            on.tani[1]+
            endoskopi_rec[1]+
                endoskopi_rec2[1]+
                endoskopi_rec3[1]+
            sitopatik_rec[1]+
            sitopatik_rec2[1]+
            sitopatik_rec3[1]+
            ihk_rec[1]+
            apopitoz_rec[1]+
            apopitoz_rec2[1]+
            iltihap_rec[1]+
            iltihap_rec2[1],
tumveri, test=FALSE)
```



```{r tangram analiz CMV son taniya gore, eval=FALSE, include=FALSE}
summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) }
assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram")
tangram::tangram(cmv.tani_rec ~ cinsiyet +
                     hasta.yasi+
                     lokalizasyon[1] +
            ozgecmis.kodlari_rec[1]+
            ozgecmis.kodlari_gr[1]+
            eslikci.hastalik.kodlari_rec[1]+
            pcr.kodu_rec[1]+
            semptom.kodlari_rec[1]+
                semptom_rec2[1]+
            on.tani[1]+
            endoskopi_rec[1]+
                endoskopi_rec2[1]+
                endoskopi_rec3[1]+
            sitopatik_rec[1]+
            sitopatik_rec2[1]+
            sitopatik_rec3[1]+
            ihk_rec[1]+
            apopitoz_rec[1]+
            apopitoz_rec2[1]+
            iltihap_rec[1]+
            iltihap_rec2[1],
tumveri, test=TRUE)
```




```{r frekans table one, include=TRUE}
library(tableone)
tableone::CreateTableOne(data = tumveri,vars = c("hasta.yasi",
                                                 "cinsiyet",
                                                 "lokalizasyon",
                                                 "lokalizasyon_rec",
                                                 "hasta.son.tani_rec",
                                                 "ozgecmis.kodlari_rec",
                                                 "ozgecmis.kodlari_gr",
                                                 "eslikci.hastalik.kodlari_rec",
                                                 "pcr.kodu_rec",
                                                 "semptom.kodlari_rec",
                                                 "semptom_rec2",
                                                 "on.tani",
                                                 "endoskopi_rec",
                                                 "endoskopi_rec2",
                                                 "endoskopi_rec3",
                                                 "sitopatik_rec",
                                                 "sitopatik_rec2",
                                                 "sitopatik_rec3",
                                                 "ihk_rec",
                                                 "cmv.tani_rec",
                                                 "apopitoz_rec",
                                                 "apopitoz_rec2",
                                                 "iltihap_rec",
                                                 "iltihap_rec2")
                         )

```




# CMV IHK Tablosu


*CMV IHK'sına göre klinikopatolojik tablo*


```{r tangram analiz CMV IHK gore, include=TRUE}
summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) }
assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram")
tangram::tangram(ihk_rec ~ cinsiyet +
                     hasta.yasi+
                     lokalizasyon[1] +
                     lokalizasyon_rec[1] +
            ozgecmis.kodlari_rec[1]+
            ozgecmis.kodlari_gr[1]+
            eslikci.hastalik.kodlari_rec[1]+
            pcr.kodu_rec[1]+
            semptom.kodlari_rec[1]+
                semptom_rec2[1]+
            on.tani[1]+
            endoskopi_rec[1]+
                endoskopi_rec2[1]+
                endoskopi_rec3[1]+
            sitopatik_rec[1]+
            sitopatik_rec2[1]+
            sitopatik_rec3[1]+
            apopitoz_rec[1]+
            apopitoz_rec2[1]+
            iltihap_rec[1]+
            iltihap_rec2[1],
tumveri, test=TRUE)
```

---


# İmmünkompetan durumu

*İmmün sistem durumuna göre klinikopatolojik özellikler*


```{r tangram analiz immun sistem durumu IHK gore, include=TRUE}
summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) }
assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram")
tangram::tangram(ozgecmis.kodlari_gr ~ cinsiyet +
                     hasta.yasi+
                     lokalizasyon[1] +
                     lokalizasyon_rec[1] +
            ozgecmis.kodlari_rec[1]+
            eslikci.hastalik.kodlari_rec[1]+
            pcr.kodu_rec[1]+
            ihk_rec[1]+
            semptom.kodlari_rec[1]+
                semptom_rec2[1]+
            on.tani[1]+
            endoskopi_rec[1]+
                endoskopi_rec2[1]+
                endoskopi_rec3[1]+
            sitopatik_rec[1]+
            sitopatik_rec2[1]+
            sitopatik_rec3[1]+
            apopitoz_rec[1]+
            apopitoz_rec2[1]+
            iltihap_rec[1]+
            iltihap_rec2[1],
tumveri, test=TRUE)
```



---

# Data For Advanced Analysis

<!-- tangram capraz tablolar ve nomogram icin veri hazirlama -->

```{r tangram capraz tablolar ve nomogram icin veri hazirlama}
ForAnalysis <- tumveri %>% 
    select(hastasirano,
           Cinsiyet = cinsiyet,
           Yas = hasta.yasi,
           Lokalizasyon = lokalizasyon,
           Lokalizasyon2 = lokalizasyon_rec,
           HastaSonTani = hasta.son.tani_rec,
           Ozgecmis = ozgecmis.kodlari_rec,
           Ozgecmis2 = ozgecmis.kodlari_gr,
           EslikEdenHastalik = eslikci.hastalik.kodlari_rec,
           SerumPCR = pcr.kodu_rec,
           Semptom = semptom.kodlari_rec,
           Semptom2 = semptom_rec2,
           Endoskopi = endoskopi_rec,
           Endoskopi2 = endoskopi_rec2,
           Endoskopi3 = endoskopi_rec3,
           Sitopatik = sitopatik_rec,
           Sitopatik2 = sitopatik_rec2,
           Sitopatik3 = sitopatik_rec3,
           IHK = ihk_rec,
           CMVTani = cmv.tani_rec,
           Apopitoz = apopitoz_rec,
           Apopitoz2 = apopitoz_rec2,
           iltihap = iltihap_rec,
           iltihap2 = iltihap_rec2
           )

```


---


# CMV IHK Diğer Tablolar

```{r include=FALSE}
library(tangram)
summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) }
assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram")

CaprazTablo1 <- tangram::html5(
tangram::tangram(IHK ~ 
Cinsiyet +
Yas[1] +
Lokalizasyon[1] +
    Lokalizasyon2[1] +
Ozgecmis[1] +
Ozgecmis2[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "CMV IHK 1", id="Tablo")


write(CaprazTablo1, "CaprazTablo1.html")

```


```{r include=FALSE}
CaprazTablo2 <- tangram::html5(
tangram::tangram(IHK ~ 
EslikEdenHastalik[1] +
SerumPCR[1] +
Semptom[1] +
    Semptom2[1]+
Endoskopi[1]+
    Endoskopi2[1]+
    Endoskopi3[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "CMV IHK 2", id="Tablo")


write(CaprazTablo2, "CaprazTablo2.html")

```



```{r include=FALSE}
CaprazTablo3 <- tangram::html5(
tangram::tangram(IHK ~ 
Sitopatik[1] +
Sitopatik2[1] +
Sitopatik3[1] +
Apopitoz[1] +
Apopitoz2[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "CMV IHK 3", id="Tablo")


write(CaprazTablo3, "CaprazTablo3.html")

```

```{r include=FALSE}
CaprazTablo4 <- tangram::html5(
tangram::tangram(IHK ~ 
iltihap[1] +
iltihap2[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "CMV IHK 4", id="Tablo")


write(CaprazTablo4, "CaprazTablo4.html")

```

---

![İmmünohistokimya 1](CMV_IHK_1.png)



---

![İmmünohistokimya 2](CMV_IHK_2.png)



---


![İmmünohistokimya 3](CMV_IHK_3.png)


---



![İmmünohistokimya 4](CMV_IHK_4.png)


---

# İmmün sistem durumuna göre tablolar


```{r include=FALSE}
library(tangram)
summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) }
assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram")

immunTablo1 <- tangram::html5(
tangram::tangram(Ozgecmis2 ~ 
Cinsiyet +
Yas[1] +
Lokalizasyon[1] +
    Lokalizasyon2[1] +
Ozgecmis[1] +
IHK

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "Immun Sistem Durumu 1", id="Tablo")


write(immunTablo1, "immunTablo1.html")

```


```{r include=FALSE}
immunTablo2 <- tangram::html5(
tangram::tangram(Ozgecmis2 ~ 
EslikEdenHastalik[1] +
SerumPCR[1] +
Semptom[1] +
    Semptom2[1]+
Endoskopi[1]+
    Endoskopi2[1]+
    Endoskopi3[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "Immun Sistem Durumu 2", id="Tablo")


write(immunTablo2, "immunTablo2.html")

```



```{r include=FALSE}
immunTablo3 <- tangram::html5(
tangram::tangram(Ozgecmis2 ~ 
Sitopatik[1] +
Sitopatik2[1] +
Sitopatik3[1] +
Apopitoz[1] +
Apopitoz2[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "Immun Sistem Durumu 3", id="Tablo")


write(immunTablo3, "immunTablo3.html")

```



```{r include=FALSE}
immunTablo4 <- tangram::html5(
tangram::tangram(Ozgecmis2 ~ 
iltihap[1] +
iltihap2[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "Immun Sistem Durumu 4", id="Tablo")


write(immunTablo4, "immunTablo4.html")

```

---

![İmmün Sistem Durumu 1](immun_1.png)

---

![İmmün Sistem Durumu 2](immun_2.png)

---

![İmmün Sistem Durumu 3](immun_3.png)


---

![İmmün Sistem Durumu 4](immun_4.png)


---

# Tek Değişkenli Analiz ve Yorumları

> **Anlamlı ilişki çıkmayanlar**

> *Tek Değişkenli Analiz*lerde IHK pozitif vakalar ile IHK negatif vakalar arasında
cinsiyet,
özgeçmişinde immünsüpresyona neden olan bir hastalık olması,
eşlik eden hastalık olması,
açısından bir fark izlenmemiştir.

> İmmünsüprese hastaların %37'sinde IHK pozitifken, immünkompetan hastaların %33'ünde IHK pozitiftir.
Serum PCR pozitif olguların %46'sında IHK pozitifken, PCR negatif olguların %38'inde pozitiftir.


> **Anlamlı ilişki çıkanlar**

> *Tek Değişkenli Analiz*lerde IHK pozitif vakalarda yaş daha yüksektir.
Alt GIS biyopsilerinde %42 olguda IHK pozitifken, üst GIS biyopsilerinde bu oran %23'tür.
Kanama ve karın ağrısı olan olgularda IHK pozitifliği daha yüksektir.
Sitopatik etkş varlığında, tek ya da birden fazla hücre grubunda da izlenmiş olsa IHK pozitifliği daha yüksektir.
Apopitoz varlığı seyrek olsa da, abse şeklinde olsa da IHK pozitifliği daha yüksektir.
Ülserli ya da ülsersiz de olsa inflamasyon varlığında IHK pozitifliği daha yüksektir.
Endoskopik bulgu varlığında, ülserli ya da ülsersiz lezyon izlendiğinde, IHK pozitifliği daha yüksektir.



```{r capraz tablolar IHK jmv, include=TRUE}
jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Cinsiyet",
                pcRow = TRUE
)

jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Lokalizasyon",
                pcRow = TRUE
)

jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Lokalizasyon2",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Ozgecmis",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Ozgecmis2",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "EslikEdenHastalik",
                pcRow = TRUE
)

         



jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "SerumPCR",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Semptom",
                pcRow = TRUE
)

         

jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Semptom2",
                pcRow = TRUE
)

          
jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Endoskopi",
                pcRow = TRUE
)

jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Endoskopi2",
                pcRow = TRUE
)

jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Endoskopi3",
                pcRow = TRUE
)

jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Sitopatik",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Sitopatik2",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Sitopatik3",
                pcRow = TRUE
)



jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Apopitoz",
                pcRow = TRUE
)
          


jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "Apopitoz2",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "iltihap",
                pcRow = TRUE
)

 
jmv::contTables(data = ForAnalysis,
                cols = "IHK",
                rows = "iltihap2",
                pcRow = TRUE
)

```


---

```{r, include=FALSE}
summarytools::view(summarytools::dfSummary(ForAnalysis))
```


---

![Verinin Özeti 1](DF_Summary_1.png)


---

![Verinin Özeti 2](DF_Summary_2.png)


---

![Verinin Özeti 3](DF_Summary_3.png)

---

![Verinin Özeti 4](DF_Summary_4.png)



---

# Çok Değişkenli Analiz

> *Çok değişkenli analiz* sonuçlarına göre IHK pozitifliği açısından apoptoz ve sitopatik etki varlığı anlamlı olarak önemli bulunmuştur.


```{r eval=TRUE, include=TRUE}
# Logistics Regression
glm.fit <- glm(IHK ~ Yas +
                   Lokalizasyon2 +
                   Endoskopi3 +
                   Sitopatik3 +
                   Apopitoz2 +
                   iltihap2 +
                   Semptom2
                   ,
               data = ForAnalysis,
               family = binomial)


summary(glm.fit)

# names(ForAnalysis)

```



---

# Nomogram

<!-- # ```{r include=FALSE} -->
<!-- # xlsx::write.xlsx(ForAnalysis, "cmvbiyopsibazli_tumveri.xlsx") -->
<!-- # write_csv(ForAnalysis, "ForAnalysis.csv") -->
<!-- # ``` -->


> **Nomogram**

> Klinik ve histomorfolojik özelliklerden yola çıkarak CMV immünohistokimya sonucunu tahmin etmek için Naive Bayes yöntemi ile bir Nomogram oluşturulmuştur. Nomogramda sitopati varlığı, immünsüpresyon hikayesi, yaş, klinik semptom varlığı, apopitoz varlığı, eşlik eden hastalık varlığı, serum PCR pozitifliği ve cinsiyet kullanılmıştır.
Elde edilen nomogram ile %83 doğru sınıflama elde edilmiştir (AUC: 0.878, Sensitivite: `r scales::percent(50/68)` , Spesifisite: `r scales::percent(111/129)`). Nomogramın yeni gelen olgular ile eksternal validasyonu yapılmaya devam edilecektir.




![](Nomogram_1.png)


---

![](Nomogram_2.png)


---

![](Nomogram_3.png)


---

![](Nomogram_4.png)



---

![](Nomogram_5.png)


---

![](Nomogram_6.png)


---


![](nomogram.png)


---


![](ROC.png)



---

<!-- ```{r, include=FALSE} -->
<!-- deneme <- tumveri %>% -->
<!--     select(hastasirano, hasta.son.tani_rec, ihk_rec, cmv.tani_rec, lokalizasyon, pcr.kodu_rec) %>%  -->
<!--     arrange(as.numeric(hastasirano)) -->
<!-- distinct(deneme) -->
<!-- ``` -->

<!-- ```{r, include=TRUE} -->
<!-- summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) } -->
<!-- assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram") -->
<!-- tangram::tangram(IHK ~  -->
<!-- Cinsiyet + -->
<!-- Yas[1] + -->
<!-- Lokalizasyon[1] + -->
<!-- Ozgecmis[1] + -->
<!-- Ozgecmis2[1] + -->
<!-- EslikEdenHastalik[1] + -->
<!-- SerumPCR[1] + -->
<!-- Semptom[1] + -->
<!-- Endoskopi[1] + -->
<!-- Sitopatik[1] + -->
<!-- Sitopatik2[1] + -->
<!-- Sitopatik3[1] + -->
<!-- Apopitoz[1] + -->
<!-- Apopitoz2[1] + -->
<!-- iltihap[1] + -->
<!-- iltihap2[1] -->
<!--     ,ForAnalysis, test=TRUE) -->
<!-- ``` -->

<!-- --- -->
<!-- # Sonuçlar -->
<!-- **Results** -->
<!-- Birkaç amacım/sorum var:  -->
<!-- 1) Excelde yer alan özellikleri yönüyle döküm almak. -->
<!-- 2) Biyopsinin patolojik incelemesinde CMV pozitifliğini en çok öngören nedir? CMV negatif ve pozitif biyopsi örneklerini karşılaştırarak bu yönde bir yoruma varabilir miyiz? ( Mesela çekum biyopsisi, CMV ön tanısı, ülser, immunsüpresyon ve apopitotik cisim …..varsa onlar cmv (+) çıkar gibi )  -->
<!-- Diğer bir nokta ise:  -->
<!-- 3) CMV (+) vakaları sıklıkla immunsuprese bekliyoruz (özgeçmişi 1,2,3,4,5 olanlar) ama nadiren immunkompetan da olabilir (özgeçmişi 6 ile kodlu olanlar). CMV (+) ler içinde, bu iki grubu karşılaştırabilir miyiz.  -->




# Hasta Son Tanıya göre tablo 


*Hasta Son Tanıya göre klinikopatolojik tablo*


```{r tangram analiz Hasta Son Taniya gore, include=TRUE}

# names(tumveri)

summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) }
assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram")
tangram::tangram(cmv.tani_rec ~ cinsiyet +
                     hasta.yasi+
                     ozgecmis.kodlari_rec[1]+
            ozgecmis.kodlari_gr[1]+
            eslikci.hastalik.kodlari_rec[1]+
            pcr.kodu_rec[1]+
            semptom.kodlari_rec[1]+
            semptom_rec2[1]+
            on.tani[1]+
            endoskopi_rec[1]+
            endoskopi_rec2[1]+
            endoskopi_rec3[1]+
            apopitoz_rec[1]+
            apopitoz_rec2[1]+
            iltihap_rec[1]+
            iltihap_rec2[1],
tumveri, test=TRUE)
```



---

# Son Tanı Diğer Tablolar

```{r Son Tani 1, include=FALSE}
# names(ForAnalysis)
library(tangram)
summary.cell_fraction <- function(object, ...) { paste0('%', object['percentage']) }
assignInNamespace("summary.cell_fraction", summary.cell_fraction, "tangram")

sontaniTablo1 <- tangram::html5(
tangram::tangram(CMVTani ~ 
Cinsiyet +
Yas[1] +
Ozgecmis[1] +
Ozgecmis2[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "Son Tani 1", id="Tablo")


write(sontaniTablo1, "sontaniTablo1.html")

```


```{r Son Tani 2, include=FALSE}
sontaniTablo2 <- tangram::html5(
tangram::tangram(CMVTani ~ 
EslikEdenHastalik[1] +
SerumPCR[1] +
Semptom[1] +
Semptom2[1]+
Endoskopi[1]+
Endoskopi2[1]+
Endoskopi3[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "Son Tani 2", id="Tablo")


write(sontaniTablo2, "sontaniTablo2.html")

```



```{r Son Tani 3, include=FALSE}
sontaniTablo3 <- tangram::html5(
tangram::tangram(CMVTani ~ 
Apopitoz[1] +
Apopitoz2[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "Son Tani 3", id="Tablo")


write(sontaniTablo3, "sontaniTablo3.html")

```


```{r Son Tani 4, include=FALSE}
sontaniTablo4 <- tangram::html5(
tangram::tangram(CMVTani ~ 
iltihap[1] +
iltihap2[1]

, ForAnalysis),
      fragment=TRUE, inline="nejm.css", caption = "Son tani 4", id="Tablo")


write(sontaniTablo4, "sontaniTablo4.html")

```

---

![Son Tanı 1](sontani_1.png)



---

![Son Tanı 2](sontani_2.png)



---


![Son Tanı 3](sontani_3.png)


---



![Son Tanı 4](sontani_4.png)


---

# Son Tanı Tek Değişkenli Analiz

> Son tanısı pozitif olan hastaların %67'inde eşlik hastalık varken, son tanısı negatif olan hastaların %36'sında eşlik eden hastalık vardır (p=0.037).
Endoskopik olarak ülser ya da başka bulgu olanlarda son tanı daha çok pozitiftir (p < 0.001).
Son tanısı pozitif olan olgularda apopitoz ve inflamasyon varlığı anlamlı olarak yüksektir (p < 0.001).





> Son tanı ile cinsiyet arasında ilişki yoktur.
Son tanı ile immünkompetan olma durumu arasında bir ilişki yoktur.
Son tanı ile serum PCR pozitif olma durumu ararsında bir ilişki yoktur.
Son tanı ile semptomatik olma durumu ararsında bir ilişki yoktur.




```{r capraz tablolar Son Tani jmv, include=TRUE}
jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Cinsiyet",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Ozgecmis",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Ozgecmis2",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "EslikEdenHastalik",
                pcRow = TRUE
)

         



jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "SerumPCR",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Semptom",
                pcRow = TRUE
)

         

jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Semptom2",
                pcRow = TRUE
)

          
jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Endoskopi",
                pcRow = TRUE
)

jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Endoskopi2",
                pcRow = TRUE
)

jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Endoskopi3",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Apopitoz",
                pcRow = TRUE
)
          


jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "Apopitoz2",
                pcRow = TRUE
)


jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "iltihap",
                pcRow = TRUE
)

 
jmv::contTables(data = ForAnalysis,
                cols = "CMVTani",
                rows = "iltihap2",
                pcRow = TRUE
)

```




---


# Son Tanı Çok Değişkenli Analiz

> Son tanı için çok değişkenli analizde yaş, apopitoz ve inflamasyon varlığı anlamlı etken olarak bulunmuştur. 


```{r CMVTani regresyon, eval=TRUE, include=TRUE}
# Logistics Regression
glm.fit2 <- glm(CMVTani ~ 
                    Cinsiyet +
                    Yas +
                    Ozgecmis2 +
                   EslikEdenHastalik +
                    SerumPCR +
                    Semptom2 +
                   Endoskopi3 +
                   # Apopitoz2 +
                   iltihap2
                   ,
               data = ForAnalysis,
               family = binomial)


summary(glm.fit2)

# names(ForAnalysis)

```




# Son Tanı Nomogram


Son Tanıya göre yapılan nomogram ve karar ağacı yöntemlerinden anlamlı model oluşmamıştır.




![Son Tanıya Göre Nomogram AUC](sontani_nomogram.png)





---

<!-- # ```{r include=FALSE} -->
<!-- # xlsx::write.xlsx(ForAnalysis, "cmvbiyopsibazli_tumveri.xlsx") -->
<!-- # write_csv(ForAnalysis, "ForAnalysis.csv") -->
<!-- # ``` -->
